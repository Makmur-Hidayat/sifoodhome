<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIPORA FOOD - Order & Delivery COD di Ibukota Mentawai</title>
    <meta name="description" content="Sipora Food: Website untuk order makanan dari berbagai warung makan dan restoran di Sipora. Aman, mudah, dan praktis!">

    <meta property="og:title" content="Sipora Food - Order Makanan Online di tuapejat Sipora mentawai">
    <meta property="og:description" content="Sipora Food: Aplikasi Website untuk memesan makanan dari berbagai warung makan dan restoran di Sipora tuapejat mentawai. Aman, mudah, dan praktis!">
    <meta property="og:image" content="https://i.ibb.co/0j6fJ6Xv/Sipora-Food.jpg">
    <meta property="og:url" content="https://sifood.online">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #FF7043;
            --secondary-color: #4ECDC4;
            --background-color: #F7F7F7;
            --text-color: #333;
            --card-background: #FFFFFF;
            --border-color: #E0E0E0;
            --disabled-color: #BDBDBD;
            --overlay-background: rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            padding-bottom: 70px; /* Space for fixed bottom navigation */
        }

        #app-container {
            max-width: 412px;
            margin: 0 auto;
            min-height: calc(100vh - 70px);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .app-header input[type="search"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-size: 1em;
        }

        main {
            padding: 15px;
        }

        .page { display: none; }
        .page.active-page { display: block; }

        #bottom-navigation {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: var(--card-background); display: flex;
            justify-content: space-around; box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            border-top: 1px solid var(--border-color); z-index: 1000;
            /* Penyesuaian untuk app-container dengan max-width */
            left: 50%;
            transform: translateX(-50%);
            max-width: 412px; /* Sama dengan #app-container */
        }

        .nav-button {
            background: none; border: none; color: var(--text-color);
            padding: 10px 5px; cursor: pointer; flex-grow: 1; text-align: center;
            font-size: 0.8em; display: flex; flex-direction: column;
            align-items: center; position: relative;
        }
        .nav-button i { font-size: 1.5em; margin-bottom: 4px; }
        .nav-button.active { color: var(--primary-color); }
        .nav-button .badge {
            position: absolute; top: 5px; right: 15%;
            background-color: red; color: white; border-radius: 50%;
            padding: 2px 6px; font-size: 0.7em; line-height: 1;
        }

        #store-list-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .store-card {
            background-color: var(--card-background); border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden;
            cursor: pointer; transition: transform 0.2s ease-in-out;
        }
        .store-card:hover { transform: translateY(-5px); }
        .store-image-container {
            position: relative;
            width: 100%;
            height: 120px;
            background-color: #eee; /* Warna placeholder jika gambar belum load */
        }
        .store-image { width: 100%; height: 100%; object-fit: cover; }
        .store-card.closed .store-image { filter: grayscale(100%) blur(0px); }
        .store-status-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--overlay-background); color: white; display: flex;
            justify-content: center; align-items: center; font-size: 1.5em; font-weight: bold;
        }
        .store-info { padding: 10px; }
        .store-name { margin-top: 0; margin-bottom: 5px; color: var(--primary-color); }
        .store-hours { font-size: 0.9em; color: #555; }

        .modal {
            display: none; position: fixed; z-index: 1001; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: var(--overlay-background);
        }
        .modal-content {
            background-color: var(--background-color); margin: 10% auto; padding: 20px;
            border-radius: 8px; width: 90%; 
            max-height: 80vh;
            overflow-y: auto; position: relative;
            /* Penyesuaian untuk app-container dengan max-width */
            max-width: calc(412px - 40px); /* max-width app dikurangi padding modal */
        }

        .close-button {
            color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-button:hover, .close-button:focus { color: black; }
        #modal-store-name { margin-top: 0; color: var(--primary-color); }
        #modal-store-closed-message {
            color: var(--primary-color); font-weight: bold; text-align: center; margin-bottom: 15px;
            padding: 10px; background-color: #ffebee; border: 1px solid var(--primary-color); border-radius: 4px;
        }
        #modal-menu-items-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .menu-item-card {
            background-color: var(--card-background); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 10px; display: flex; flex-direction: column;
        }
        .menu-item-card.inactive, .menu-item-card.store-closed { filter: grayscale(80%) opacity(0.6); }
        .menu-item-card.inactive .add-to-cart-btn,
        .menu-item-card.store-closed .add-to-cart-btn,
        .menu-item-card.inactive .menu-item-extras-select,
        .menu-item-card.store-closed .menu-item-extras-select {
             pointer-events: none;
             background-color: var(--disabled-color) !important;
             color: #888 !important;
             border-color: var(--disabled-color) !important;
        }
         .menu-item-card.inactive .add-to-cart-btn,
        .menu-item-card.store-closed .add-to-cart-btn {
            background-color: var(--disabled-color) !important;
        }

        .menu-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            background-color: #eee; /* Warna placeholder */
        }
        .menu-name { margin: 5px 0; font-size: 1.1em; }
        .menu-price { font-weight: bold; color: var(--secondary-color); margin-bottom: 10px; }

        .menu-extras label {
            display: block;
            margin-bottom: 5px;
            font-weight: normal;
        }
        .menu-extras select[multiple].menu-item-extras-select {
            width: 100%;
            padding: 8px;
            /* height: 25px; Ini mungkin terlalu kecil untuk multiple select */
            border-radius: 4px;
            border: 1px solid var(--border-color);
            min-height: 35px; /* Sesuaikan ini */
            background-color: #f9f9f9; /* Kustomisasi warna dropdown agar terlihat aktif */
            box-sizing: border-box;
        }
        .menu-extras select[multiple].menu-item-extras-select:disabled {
            background-color: #e9ecef;
            opacity: 0.7;
        }

        .menu-controls { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .quantity-control { display: flex; align-items: center; }
        .qty-btn {
            background-color: var(--secondary-color); color: white; border: none; border-radius: 4px;
            width: 25px; height: 25px; cursor: pointer; font-weight: bold;
        }
        .qty-btn:disabled { background-color: var(--disabled-color); cursor: not-allowed; }
        .qty-value { margin: 0 10px; font-weight: bold; }
        .menu-subtotal { font-weight: 15px; }
        .menu-notes {
            width: 100%;
            padding: 8px; margin-top: 10px;
            border: 1px solid var(--border-color); border-radius: 4px;
            resize: vertical; min-height: 40px; box-sizing: border-box;
        }
        .add-to-cart-btn { margin-top: 10px; }

        .button-primary {
            background-color: var(--primary-color); color: white; padding: 10px 15px;
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            transition: background-color 0.2s; width: 100%;
        }
        .button-primary:hover { background-color: #E55353; }
        .button-primary:disabled { background-color: var(--disabled-color); cursor: not-allowed; }
        .button-secondary {
            background-color: var(--secondary-color); color: white; padding: 8px 12px;
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            transition: background-color 0.2s;
        }
        .button-secondary:hover { background-color: #3AAFA9; }

        .empty-cart-message, .empty-history-message { text-align: center; color: #777; padding: 20px; font-style: italic; }
        #cart-items-container { margin-bottom: 20px; }
        .cart-item-card {
            background-color: var(--card-background); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex;
            gap: 15px; align-items: flex-start; position: relative;
        }
        .cart-item-image { 
            width: 80px; height: 80px; object-fit: cover; border-radius: 4px;
            background-color: #eee; /* Warna placeholder */
        }
        .cart-item-details { flex-grow: 1; }
        .cart-item-details h4, .cart-item-details p { margin: 0 0 5px 0; }
        .cart-item-store { font-size: 0.9em; color: #555; }
        .cart-item-extras { font-size: 0.9em; color: #777; }
        .cart-item-notes { font-size: 0.9em; color: #777; font-style: italic; }
        .cart-item-summary { text-align: right; min-width: 100px; }
        .cart-item-order-time { font-size: 0.8em; color: #999; display: block; margin-top: 5px; }
        .remove-from-cart-btn {
            background: none; border: none; color: var(--primary-color);
            font-size: 1.2em; cursor: pointer; position: absolute; top: 10px; right: 10px;
        }
        #cart-summary {
            background-color: var(--card-background); padding: 15px; border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #cart-summary p, #cart-summary h3 { margin: 10px 0; }
        #cart-summary hr { border: none; border-top: 1px solid var(--border-color); margin: 15px 0; }

        .delivery-location-section { margin-top: 15px; border-top: 1px dashed var(--border-color); padding-top: 15px; }
        .delivery-location-section label { display: block; margin-bottom: 5px; font-weight: bold; }
        .delivery-location-section select, .delivery-location-section textarea {
            width: 100%;
            padding: 10px; margin-bottom: 10px; border: 1px solid var(--border-color); border-radius: 4px;
            box-sizing: border-box;
        }
         .delivery-location-section textarea {
            min-height: 60px; resize: vertical;
        }

        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background-color: var(--text-color); color: white; padding: 12px 20px;
            border-radius: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1002;
            opacity: 0; visibility: hidden; transition: opacity 0.5s, visibility 0.5s, bottom 0.5s;
            font-size: 0.9em;
            /* Penyesuaian untuk app-container dengan max-width */
            max-width: calc(412px - 40px); 
            width: auto; 
        }
        .toast.show { opacity: 1; visibility: visible; bottom: 90px; }
        .toast.success { background-color: #4CAF50; }
        .toast.error { background-color: #F44336; }

        .history-item-card {
            background-color: var(--card-background); border: 1px solid var(--border-color);
            border-radius: 8px; margin-bottom: 15px; padding: 15px;
        }
        .history-item-header { border-bottom: 1px dashed var(--border-color); padding-bottom: 10px; margin-bottom: 10px; }
        .history-item-header h4 { margin: 0; }
        .history-item-header p { margin: 5px 0 0 0; font-size: 0.9em; color: #555; }
        .history-item-body .menu-item-entry { font-size: 0.9em; padding: 3px 0; }
        .history-item-body .menu-item-entry .extras { font-size: 0.85em; color: #666; padding-left: 15px; }
        .history-item-footer { margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); }
        .history-item-footer p { margin: 5px 0; font-size: 0.9em; }
        .history-item-footer .reorder-btn { margin-top: 10px; width: auto; }

        /* STYLES UNTUK GLOBAL LOADER */
        #app-loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9); /* Latar belakang semi-transparan */
            z-index: 2000; /* Pastikan di atas segalanya */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s ease-in-out;
        }

        .loader-spinner {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid var(--primary-color); /* Warna primer Anda */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* STYLES UNTUK LAZY LOAD IMAGE */
        .lazy-image {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .lazy-image.loaded {
            opacity: 1;
        }
        /* Warna placeholder diatur per elemen gambar di atas, misal .store-image-container, .menu-image */

        /* === STYLES UNTUK IMAGE SLIDER === */
        .slider-container {
            position: relative;
            width: 92%;
            max-width: 400px; /* Menyesuaikan dengan lebar container utama */
            margin:auto;
            margin-top: 3px; /* Jarak dari search bar */
            margin-bottom: 10px; /* Jarak ke daftar warung */
            overflow: hidden;
            border-radius: 15px; /* Sudut yang sedikit melengkung */
            aspect-ratio: 16 / 8,5; /* Membuat rasio gambar lebih lebar, cocok untuk promo */
            background-color: #eee; /* Warna placeholder */
        }

        .slider-wrapper {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            min-width: 100%;
            height: 100%;
            box-sizing: border-box;
        }

        .slide img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Memastikan gambar memenuhi slide tanpa distorsi */
            display: block;
        }

        .slider-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .dot.active {
            background-color: var(--primary-color);
        }
        /* === AKHIR STYLES UNTUK IMAGE SLIDER === */


/* === CSS LENGKAP DAN SIAP PAKAI UNTUK FITUR KURIR === */

/* Container Utama */
.container-kurir {
    width: 100%;
    background-color: var(--card-background);
    border-radius: 5px;
    padding: 5px;
}

/* Grup Form */
.container-kurir .form-group {
    margin-bottom: 15px;
}

.container-kurir .form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 0.95rem;
}

/* Input dan Textarea */
.container-kurir .form-control {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    font-family: 'Arial', sans-serif;
    transition: border-color 0.3s, box-shadow 0.3s;
    box-sizing: border-box;
}

.container-kurir .form-control:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.25);
}

.container-kurir textarea.form-control {
    resize: vertical;
    min-height: 80px;
}

/* Grid Layanan Kurir */
.container-kurir .service-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.container-kurir .service-btn {
    padding: 12px 5px;
    border-radius: 8px;
    border: 2px solid var(--border-color);
    background-color: #fff;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    color: var(--primary-color);
}

.container-kurir .service-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(255, 112, 67, 0.3);
}

/* Opsi Pilihan (Radio Button) */
.container-kurir .choice-options {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.container-kurir .choice-options label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 0.95rem;
}

.container-kurir input[type="radio"] {
    accent-color: var(--primary-color);
}

/* Opsi Spesifik per Layanan */
.container-kurir .service-specific-options {
    padding: 15px;
    background-color: var(--background-color);
    border: 1px dashed var(--border-color);
    border-radius: 8px;
    margin-top: 15px;
}

/* Daftar Belanja */
.container-kurir #shopping-list-container .shopping-item-row {
    display: grid;
    grid-template-columns: 25px 1fr 70px 70px;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
}
.container-kurir #shopping-list-container .shopping-item-row span {
    text-align: center;
}

.container-kurir #shopping-list-container .shopping-item-header {
     font-size: 0.9rem;
     font-weight: 600;
     color: var(--text-color);
     margin-bottom: 10px;
     padding: 0 5px;
}

/* Kartu Total Biaya */
.container-kurir .total-display {
    background-color: #fff3e0;
    color: var(--primary-color);
    padding: 20px;
    text-align: center;
    border-radius: 8px;
    margin-top: 20px;
    border: 1px solid var(--primary-color);
    margin-bottom: 20px; /* ---> [MODIFIKASI] Menambahkan jarak ke tombol di bawahnya */
}

.container-kurir .total-display p {
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 5px;
}

.container-kurir .total-display h2 {
    font-size: 2em;
    font-weight: 700;
    letter-spacing: 1px;
    margin: 0;
}

/* Tombol Kirim Orderan (Submit) */
/* Diasumsikan tombol submit Anda memiliki class .submit-btn */
.container-kurir .submit-btn {
    width: 100%;
    padding: 15px;
    background-color: #ff70433; /* Warna khas WhatsApp */
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s;
    /* --- [MODIFIKASI] Penyesuaian ukuran font dan layout --- */
    font-size: 1rem;       /* Ubah ukuran tulisan sesuai kebutuhan */
    display: flex;         /* Mengaktifkan flexbox untuk alignment */
    align-items: center;   /* Membuat ikon dan teks sejajar vertikal */
    justify-content: center; /* Membuat ikon dan teks di tengah tombol */
    gap: 10px;             /* Memberi jarak antara ikon dan tulisan */
}

.container-kurir .submit-btn:hover {
    background-color: #128C7E; /* Warna WhatsApp saat di-hover */
}

.container-kurir .submit-btn i {
    font-size: 1.2em; /* Ukuran ikon sedikit lebih besar dari teks */
}

/* Class untuk menyembunyikan elemen */
.container-kurir .hidden {
    display: none !important;
}

/* --- Bagian Riwayat Order --- */

#history-section-kurir {
    padding: 20px 0;
    margin-top: 20px;
    border-top: 1px solid var(--border-color);
}

#history-section-kurir h3 {
    text-align: center;
    margin-bottom: 15px;
    color: var(--primary-color);
    font-size: 1.1rem;
}

#history-list-kurir {
    list-style: none;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
}

.history-item {
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    position: relative;
}

.history-item p {
    font-size: 0.9rem;
    margin-bottom: 5px;
    line-height: 1.4;
}

.history-item p strong {
    color: var(--primary-color);
}

.history-item .details-block {
    background-color: #f7f7f7;
    border-left: 3px solid var(--secondary-color);
    padding: 10px;
    margin-top: 10px;
    font-size: 0.9em;
    border-radius: 4px;
}

.history-item .details-block ul {
    padding-left: 15px;
    margin: 0;
}

.history-item .reorder-btn {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: opacity 0.3s;
    position: absolute;
    top: 15px;
    right: 15px;
}
.history-item .reorder-btn:hover {
    opacity: 0.85;
}

#clear-history-btn-kurir {
    display: block;
    margin: 15px auto 0;
    background: #E57373;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    font-size: 0.95rem;
    cursor: pointer;
}
/* === AKHIR CSS UNTUK FITUR KURIR === */

/* === CSS UNTUK FOOTER COPYRIGHT === */
        .app-footer {
            text-align: center;
            padding: 5px 5px; /* Memberi jarak atas/bawah */
            font-size: 0.95em;  /* Ukuran font sedikit lebih kecil */
            color: #888;         /* Warna abu-abu agar tidak terlalu mencolok */
            border-top: 1px solid var(--border-color); /* Garis pemisah tipis */
            margin-top: 5px; /* Jarak dari konten di atasnya */
        }
        /* === AKHIR CSS UNTUK FOOTER COPYRIGHT === */


    </style>
</head>
<body>
    <div id="app-loader-overlay">
        <div class="loader-spinner"></div>
    </div>

    <div id="app-container">
        <div id="page-home" class="page active-page">
            <header class="app-header">
                <input type="search" id="search-bar" placeholder="SIFOOD: Cari warung atau menu disini...">
            </header>
            <div class="slider-container">
                <div class="slider-wrapper">
                    <div class="slide"><img src="https://i.ibb.co.com/dJLmZGhp/IMG-20250508-230725-5-11zon.jpg" alt="Promo Sifood 1"></div>
                    <div class="slide"><img src="https://i.ibb.co.com/bgTQ546y/IMG-20250508-232846-1-11zon.jpg" alt="Promo Sifood 2"></div>
                    <div class="slide"><img src="https://i.ibb.co.com/mVG9k98W/IMG-20250508-230752-4-11zon.jpg" alt="Promo Sifood 3"></div>
                    <div class="slide"><img src="https://i.ibb.co.com/ZR6VbPM7/IMG-20250508-230825-3-11zon.jpg" alt="Promo Sifood 4"></div>
                    <div class="slide"><img src="https://i.ibb.co.com/bgTQ546y/IMG-20250508-232846-1-11zon.jpg" alt="Promo Sifood 5"></div>
                </div>
                <div class="slider-dots"></div>
            </div>


            <main id="store-list-container"></main>
        </div>

        <div id="page-keranjang" class="page">
            <header class="app-header">
                <h2>Keranjang Saya</h2>
            </header>
            <main>
                <div id="cart-items-container">
                    <p class="empty-cart-message">Keranjang masih kosong.</p>
                </div>
                <div id="cart-summary" style="display: none;">
                    <p>Total Orderan: <span id="cart-subtotal">Rp 0</span></p>
                    <div class="delivery-location-section">
                        <select id="delivery-location">
                            <option value="">-- 📍Pilih Lokasi Antar--</option>
                            <option value="0">Km-0</option><option value="1">Km-1</option><option value="2">Km-2</option>
                            <option value="3">Km-3</option><option value="4">Km-4</option><option value="5">Km-5</option>
                            <option value="6">Km-6</option><option value="7">Km-7</option><option value="8">Km-8</option>
                            <option value="9">Km-9</option><option value="10">Km-10</option>
                        </select>
                        <textarea id="delivery-location-detail" placeholder="Detail Lokasi Antar, Misal: Gang bulian Rumah ke-4 sebelah kiri atau. A/n Nia RSUD Ruang Kainau"></textarea>
                        <p>Ongkir: <span id="delivery-fee">Rp 0</span></p>
                        <small>Pastikan chatmu terkirim ke Whatsapp admin agar orderanmu di proses yah</small>
                    </div>
                    <hr>
                    <h3>Total Orderan + Ongkir: <span id="cart-total-payment">Rp 0</span></h3>
                    <button id="send-order-btn" class="button-primary" disabled>Kirim Orderan ke Whatsapp Admin</button>
                </div>
            </main>
        </div>

        <div id="page-kurir" class="page">
    <header class="app-header"><h2>Titip Beli, Ojek & Kurir</h2></header>
    <main>
        <div class="container-kurir"> <div id="order-form">
                <div class="form-group">
                    <label>Pilih Layanan</label>
                    <div class="service-grid">
                        <button class="service-btn" data-service="Titip Beli">🛒 Titip Beli</button>
                        <button class="service-btn" data-service="Kirim Barang">📦 Kirim Barang</button>
                        <button class="service-btn" data-service="Ojek">🛵 Ojek</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="pickup-location" id="pickup-label">Lokasi Jemput</label>
                    <select id="pickup-location" class="form-control" required>
                        <option value="">-- 📍 Pilih Lokasi --</option>
                        <option value="0">Kilometer-0</option><option value="1">Kilometer-1</option><option value="2">Kilometer-2</option><option value="3">Kilometer-3</option><option value="4">Kilometer-4</option><option value="5">Kilometer-5</option><option value="6">Kilometer-6</option><option value="7">Kilometer-7</option><option value="9">Kilometer-9</option><option value="10">Kilometer-10</option><option value="6">(Other) SP2 Desa Sido Makmur</option><option value="4">(Other) Mapaddegat Bawah</option><option value="10">(Other) SP3 Bukit Pamewa</option><option value="20">(Other) Desa Goisooinan</option><option value="35">(Other) Desa Pogari</option><option value="42">(Other) Bandara Rokot</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" id="pickup-detail" class="form-control" placeholder="Detail Lokasi Jemput, Cth: Pelabuhan Kapal Mentawai fast" required>
                </div>

                <div class="form-group">
                    <label for="dropoff-location">Lokasi Antar</label>
                    <select id="dropoff-location" class="form-control" required>
                        <option value="">-- 📍 Pilih Lokasi Antar --</option>
                         <option value="0">Kilometer-0</option><option value="1">Kilometer-1</option><option value="2">Kilometer-2</option><option value="3">Kilometer-3</option><option value="4">Kilometer-4</option><option value="5">Kilometer-5</option><option value="6">Kilometer-6</option><option value="7">Kilometer-7</option><option value="9">Kilometer-9</option><option value="10">Kilometer-10</option><option value="6">(Other) SP2 Desa Sido Makmur</option><option value="4">(Other) Mapaddegat Bawah</option><option value="10">(Other) SP3 Bukit Pamewa</option><option value="20">(Other) Desa Goisooinan</option><option value="35">(Other) Desa Pogari</option><option value="42">(Other) Bandara Rokot</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" id="dropoff-detail" class="form-control" placeholder="Detail Lokasi Antar,  Cth: gang beringin no 5" required>
                </div>

                <div class="form-group">
                    <div class="choice-options">
                        <label><input type="radio" name="schedule-type" value="sekarang" checked> Untuk Sekarang</label>
                        <label><input type="radio" name="schedule-type" value="nanti"> Untuk Nanti</label>
                    </div>
                </div>
                <div id="schedule-section" class="form-group hidden">
                    <label for="schedule-datetime">Pilih Tanggal & Jam Pengantaran</label>
                    <input type="datetime-local" id="schedule-datetime" class="form-control">
                </div>

                <div id="titip-beli-options" class="service-specific-options hidden">
                    <div class="form-group">
                        <div id="shopping-list-container">
                            <div class="shopping-item-row shopping-item-header">
                                <span>No.</span><span>Nama Barang</span><span>Jumlah</span><span>keterangan</span>
                            </div>
                            <div class="shopping-item-row">
                                 <span>1.</span>
                                 <input type="text" class="form-control shopping-item-name" placeholder="Telur">
                                 <input type="number" class="form-control shopping-item-qty" placeholder="10">
                                 <input type="text" class="form-control shopping-item-unit" placeholder="butir">
                            </div>
                        </div>
                    </div>
                    <div id="shopping-cost-section" class="form-group">
                        <input type="number" id="shopping-cost" class="form-control" placeholder="Perkiraan total Belanjaan cth: 50000" required>
                    </div>
                </div>

                <div id="kirim-barang-options" class="service-specific-options hidden">
                    <div class="form-group">
                         <input type="text" id="item-info" class="form-control" placeholder="Info Barang, Cth: Dus, Baju, Kunci" required>
                    </div>
                    <div class="form-group">
                        <div class="choice-options">
                            <label><input type="radio" name="shipping-payer" value="Pengirim" required checked> Ongkir dibayar Pengirim</label>
                            <label><input type="radio" name="shipping-payer" value="Penerima"> ongkir dibayar Penerima</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="choice-options">
                            <label><input type="radio" name="cod-status" value="Sudah Lunas" required checked> Barang Sudah Lunas</label>
                            <label><input type="radio" name="cod-status" value="Belum Lunas (COD)"> Barang Belum Lunas (COD)</label>
                        </div>
                    </div>
                    <div id="cod-cost-section" class="form-group hidden">
                        <input type="number" id="cod-cost" class="form-control" placeholder="Harga Barang, cth: 150000">
                    </div>
                </div>

                <div id="ojek-options" class="service-specific-options hidden">
                     <div class="form-group">
                         <textarea id="ojek-notes" class="form-control" placeholder="Catatan, Cth: Mohon tunggu di depan gerbang, pakai helm" required></textarea>
                    </div>
                </div>

                <div class="total-display">
                    <p>Total Biaya</p>
                    <h2 id="total-cost">Rp 0</h2>
                </div>

                <button id="submit-order-kurir" class="submit-btn button-primary"> <i class="fab fa-whatsapp"></i> <span>Kirim Orderan ke WhatsApp Admin</span>
                </button>
            </div>
            
            <section id="history-section-kurir"> <h3>Riwayat Pesanan Kurir</h3>
                <ul id="history-list-kurir"></ul> <button id="clear-history-btn-kurir" class="hidden">Hapus Riwayat Kurir</button> </section>
        </div>
        </main>
</div>


        <div id="page-riwayat" class="page">
            <header class="app-header"><h2>Riwayat Pesanan</h2></header>
            <main id="history-items-container"><p class="empty-history-message">Belum ada riwayat pesanan.</p></main>
        </div>
    </div>
<footer class="app-footer">
    <p>© <span id="copyright-year"></span> Sipora Food. All Rights Reserved.</p>
</footer>

    <nav id="bottom-navigation">
        <button data-page="home" class="nav-button active"><i class="fas fa-home"></i> <span class="nav-text">Home</span></button>
        <button data-page="keranjang" class="nav-button"><i class="fas fa-shopping-cart"></i> <span class="nav-text">Keranjang</span> <span id="cart-count-badge" class="badge" style="display:none;">0</span></button>
        <button data-page="kurir" class="nav-button"><i class="fas fa-motorcycle"></i> <span class="nav-text">Titip Beli/Ojek/Kurir</span></button>
        <button data-page="riwayat" class="nav-button"><i class="fas fa-history"></i> <span class="nav-text">Riwayat</span></button>
    </nav>

    <div id="store-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2 id="modal-store-name">Nama Toko</h2>
            <div id="modal-store-closed-message" style="display:none;">Toko sedang tutup. Anda tidak dapat memesan saat ini.</div>
            <div id="modal-menu-items-container"></div>
        </div>
    </div>

    <div id="toast-notification" class="toast"></div>

    <template id="store-card-template">
        <div class="store-card">
            <div class="store-image-container">
                <img data-src="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Gambar Toko" class="store-image lazy-image">
                <div class="store-status-overlay" style="display:none;">TUTUP</div>
            </div>
            <div class="store-info"><h3 class="store-name">Nama Toko</h3><p class="store-hours">Jam Operasional: Senin-Sabtu 00:00-00:00</p></div>
        </div>
    </template>

    <template id="menu-item-template">
        <div class="menu-item-card">
            <img data-src="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Gambar Menu" class="menu-image lazy-image">
            <h4 class="menu-name">Nama Menu</h4>
            <p class="menu-price">Rp 0</p>
            <div class="menu-extras">
                <label for="menu-item-extras-select-template">Extra*:</label>
                <select multiple class="menu-item-extras-select" id="menu-item-extras-select-template">
                </select>
            </div>
            <div class="menu-controls">
                <div class="quantity-control"><button class="qty-btn minus" disabled>-</button><span class="qty-value">1</span><button class="qty-btn plus">+</button></div>
                <span class="menu-subtotal">Rp 0</span>
            </div>
            <textarea class="menu-notes" placeholder="Catatan (opsional)..."></textarea>
            <button class="add-to-cart-btn button-primary">Tambah ke Keranjang</button>
        </div>
    </template>

    <template id="cart-item-template">
        <div class="cart-item-card">
            <img data-src="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Gambar Menu" class="cart-item-image lazy-image">
            <div class="cart-item-details">
                <h4 class="cart-item-name">Nama Menu</h4><p class="cart-item-store">Dari: Nama Toko</p>
                <p class="cart-item-price">Harga: Rp 0</p><p class="cart-item-extras">Extra: Tidak ada</p>
                <p class="cart-item-notes">Catatan: -</p>
            </div>
            <div class="cart-item-summary">
                <p>Qty: <span class="cart-item-qty">1</span></p><p>Subtotal: <span class="cart-item-subtotal">Rp 0</span></p>
                <small class="cart-item-order-time">Dipesan: dd/mm/yyyy hh:mm</small>
            </div>
            <button class="remove-from-cart-btn"><i class="fas fa-trash-alt"></i></button>
        </div>
    </template>

    <template id="history-item-template">
        <div class="history-item-card">
            <div class="history-item-header"><h4>Pesanan dari <span class="history-store-names"></span></h4><p>Waktu Pesan: <span class="history-order-time"></span></p></div>
            <div class="history-item-body"></div>
            <div class="history-item-footer">
                <p>Total: <span class="history-total-amount"></span> (termasuk ongkir Rp <span class="history-delivery-fee"></span>)</p>
                <p>Lokasi Antar: <span class="history-delivery-location"></span></p>
                <p>Detail Lokasi: <span class="history-delivery-location-detail"></span></p>
                <button class="reorder-btn button-secondary">Order Ulang</button>
            </div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
document.getElementById('copyright-year').textContent = new Date().getFullYear();

            // --- GLOBAL LOADER ELEMENTS ---
            const appLoaderOverlay = document.getElementById('app-loader-overlay');

            function showAppLoader() {
                if (appLoaderOverlay) appLoaderOverlay.style.display = 'flex';
            }
            function hideAppLoader() {
                if (appLoaderOverlay) appLoaderOverlay.style.display = 'none';
            }

            // Tampilkan loader segera
            showAppLoader();

            const storesData = [
                {
                    id: "dapoerwawao003", nama: "Dapoer Wawa", jamOperasional: "Senin-minggu 12:00-21:00",
                    gambar: "https://i.ibb.co.com/gMv6VZv8/1746720000453v-DAPOERWAWA050163b66a0266b3a-2-11zon.jpg", 
                    lokasitoko: "km-8",
                    menu: [
                        { id: "sk_ayam_geprek", nama: "Ayam geprek", harga: 20000, gambar: "https://i.ibb.co.com/xq07tNLj/4915c85728836.jpg", extra: [{ nama: "Pakai Putih", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_pecel-lele", nama: "Pecel lele", harga: 17000, gambar: "https://i.ibb.co.com/JFd7dGnS/3fe1541ea240913106.jpg", extra: [{ nama: "Pakai Putih", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                        { id: "mie Goreng_telur", nama: "mie Goreng pedas + telur", harga: 15000, gambar: "https://i.ibb.co.com/G4DStk1N/838a56678862.jpg", extra: [], status: "Aktif" },
                        { id: "teh_hijau_original", nama: "teh hijau Original", harga: 5000, gambar: "https://i.ibb.co.com/35LmPnvL/a0d1f08963198.jpg", extra: [], status: "Aktif" },
                        { id: "teh_hijau_susu", nama: "teh hijau + Susu", harga: 6000, gambar: "https://i.ibb.co.com/jPZgXPRM/2282969931308.jpg", extra: [], status: "Aktif" },
                        { id: "es_blend_beludru", nama: "es blend Beludru", harga: 6000, gambar: "https://i.ibb.co.com/v0wd2Bk/c55c3b896614.jpg", extra: [], status: "Aktif" },
                        { id: "es_blend_coklat", nama: "es blend coklat Sultan", harga: 6000, gambar: "https://i.ibb.co.com/whj0WJKh/5a0df23762975.jpg", extra: [], status: "Aktif" },
                    ]       
                },
                {
                    id: "salerokito001", nama: "Rumah Makan Salero Kito", jamOperasional: "Senin-minggu 11:00-20:00",
                    gambar: "https://i.ibb.co.com/y2SjJxN/1746719972510v-Rm-Salero-Kito093363be92e4a9392-3-11zon.jpg", 
                    lokasitoko: "km-8",
                    menu: [
                        { id: "sk_este_manis", nama: "esteh manis", harga: 8000, gambar: "https://i.ibb.co.com/TxsM1hB1/esteh.jpg", extra: [], status: "Aktif" },
                        { id: "sk_jus_mangga", nama: "mangga", harga: 15000, gambar: "https://i.ibb.co.com/XkFjvf5V/1747140345891v-Jus-Buah-Mangga070463c3991192cc9-9-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "sk_jus_jeruk", nama: "jus jeruk", harga: 15000, gambar: "https://i.ibb.co.com/YT8qHQ5Z/1747140335236v-Jus-Buah-Jeruk021063c3a1c8c07f6-11-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "sk_jus_alupakat", nama: "jus alpukat", harga: 15000, gambar: "https://i.ibb.co.com/gMTCcTSg/1747140341154v-Jus-Buah-Alpokat018863c39a028d90c-10-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "sk_ikan_goreng_cabe", nama: "ikan goreng cabe hijau", harga: 18000, gambar: "https://i.ibb.co.com/MD5nHR7x/1747140419417v-Ikan-Lado-Ijau093763be93d97fcfc-1-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ikan_bakar", nama: "ikan Bakar", harga: 18000, gambar: "https://i.ibb.co.com/Xxb1ntRL/1747140392654v-Ikan-Panggang018663c69469d511e-6-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ikan_gulai", nama: "ikan gulai", harga: 18000, gambar: "https://i.ibb.co.com/tTJBKpXK/1747140410661v-Ikan-Gulai099663be9528141fb-3-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ayam_bakar", nama: "Ayam Bakar", harga: 18000, gambar: "https://i.ibb.co.com/vv6pPKdt/images-2.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ayam_kecap", nama: "Ayam kecap", harga: 18000, gambar: "https://i.ibb.co.com/rrkrHBV/images-3.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ayam_cabe_hijau", nama: "Ayam goreng cabe hijau", harga: 18000, gambar: "https://i.ibb.co.com/KcJVd6Yx/1747140404848v-Ayam-Ladi-Ijau021063be95ab6794a-4-11zon.jpg.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ayam_bumbu", nama: "Ayam Bumbu", harga: 18000, gambar: "https://i.ibb.co.com/0pVFhGSq/1747140415336v-Ayam-Bumbu045363be946b75b2d-2-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "sk_ayam_gulai", nama: "Ayam Gulai", harga: 18000, gambar: "https://i.ibb.co.com/V0C3BWG1/1747140399374v-Ayam-Gulai078263be965bc90ec-5-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 5000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co.com/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                    ]       
                },
{ 
                    id: "skotang_vania", nama: "WARUNG VANIA", jamOperasional: "Senin-minggu 14:00-21:00",
                    gambar: "https://i.ibb.co.com/xKdDKkHz/IMG-20250607-202713.jpg", 
                    lokasitoko: "km-7",
                    menu: [
                       { id: "pecel_ayam", nama: "Pecel ayam", harga: 17000, gambar: "https://i.ibb.co.com/LdLyGMBc/images-1749302814895.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "pecel_lele", nama: "Pecel lele", harga: 17000, gambar: "https://i.ibb.co.com/m5qTjRMv/download.jpg", extra: [{nama: "pakai nasi", harga: 5000 },{ nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "nasi_goreng_telur", nama: "nasi goreng + telur", harga: 15000, gambar: "https://i.ibb.co.com/cK2w5294/images-1-1749302814844.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" }, 
                        { id: "Mie_goreng_telur", nama: "Mie goreng + telur", harga: 15000, gambar: "https://i.ibb.co.com/S4J1sQNH/images-2.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" }, 
                        { id: "Skotang_Vania", nama: "Skotang Vania", harga: 15000, gambar: "https://i.ibb.co.com/kVBWHX7X/download-1.jpg", extra: [], status: "Aktif" }, 
                        { id: "Bandrek", nama: "Bandrek", harga: 10000, gambar: "https://i.ibb.co.com/fT3H9yc/images-3.jpg", extra: [], status: "Aktif" }, 
                        { id: "Teh_Telur", nama: "Teh Telur jahe", harga: 15000, gambar: "https://i.ibb.co.com/4RdBsJ5v/download-2.jpg", extra: [], status: "Aktif" }, 
                        { id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                         ]       
                },

                        
                { 
                    id: "Rimbozz", nama: "RIMBOZZ", jamOperasional: "Senin-minggu 14:00-21:00",
                    gambar: "https://i.ibb.co.com/Z1kzzYgJ/1747142636978v-RIMBOZZ093263b2ced310dce-15-11zon.jpg", 
                    lokasitoko: "km-5",
                    menu: [
                        { id: "Ayam_teriyaki", nama: "Ayam Teriyaki", harga: 21000, gambar: "https://i.ibb.co.com/LhzwfNfn/4c8ed85424981-14-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 7000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "Ayam_Saus_tiram", nama: "Ayam Saus Tiram", harga: 21000, gambar: "https://i.ibb.co.com/bjtnDkkg/b17ebe9194978-18-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 7000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "Ayam_Crispy", nama: "Ayam Crispy", harga: 21000, gambar: "https://i.ibb.co.com/wNH2pQ7S/6e8ff81317025-13-11zon.jpg", extra: [{ nama: "Pakai Nasi", harga: 7000 }, { nama: "Tanpa Nasi", harga: 0 }], status: "Aktif" },
                        { id: "Chicky_Friest", nama: "Chicky Fries", harga: 25000, gambar: "https://i.ibb.co.com/1f0HydJj/60b7ff3297537-12-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Burger", nama: "Rimbozz Burger", harga: 20000, gambar: "https://i.ibb.co.com/fGpcYJxH/8917fc6934141-11-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Share_meal", nama: "Share Meal", harga: 35000, gambar: "https://i.ibb.co.com/ZptZRbLk/930bf297f621109296.jpg", extra: [], status: "Aktif" },
                        { id: "Nasi_Goreng_Telur", nama: "Nasi Goreng Telur", harga: 18000, gambar: "https://i.ibb.co.com/MkmsKC8R/2ef5d03102752-17-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Nasi_Goreng_Spesial", nama: "Nasi Goreng Spesial", harga: 27000, gambar: "https://i.ibb.co.com/S44P8km5/nasi-goreng-spesial.jpg", extra: [], status: "Aktif" },
                        { id: "kentang_goreng", nama: "Kentang Goreng", harga: 15000, gambar: "https://i.ibb.co.com/6J8WM4Hz/8749644ed3af705c-1738054565261v-Rimbozz-Kentang-Goreng098163b2cf9b375af-1-11zon.png", extra: [], status: "Aktif" },

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 7000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                    ]       
                },
                { 
                    id: "bakso_krakatau", nama: "BAKSO KRAKATAU", jamOperasional: "Senin-minggu 14:00-21:00",
                    gambar: "https://i.ibb.co.com/35176nRG/1747244303361v-BAKSOKRAKATAU08896548c5760290e-1-11zon.jpg", 
                    lokasitoko: "km-8",
                    menu: [
                        { id: "bakso_Beranak", nama: "Bakso Beranak", harga: 25000, gambar: "https://i.ibb.co.com/PvQQxprX/05e22d3bb0950abc-1737204263648v-Bakso-Telor0728654dd24791160-10-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "bakso_krakatau", nama: "Bakso Krakatau", harga: 25000, gambar: "https://i.ibb.co.com/67ZsWPkb/d57f841d73d80989-1737204242679v-Bakso-Krakatau0187654dd1a7cc39d-9-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "bakso_mawar", nama: "Bakso Mawar", harga: 20000, gambar: "https://i.ibb.co.com/b5rjXqrt/dfae9f51d505c09f-1737204276629v-Bakso-Mawar-Urat0970654dd28750c55-8-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "mie_ayam", nama: "Mie Ayam tanpa Bakso", harga: 20000, gambar: "https://i.ibb.co.com/RpkmWG0L/13a30f9be0520865-1737204270145v-Mie-Ayam-Bakso0198654dd3297a603-7-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "mie_ayam_bakso", nama: "Mie Ayam Bakso", harga: 20000, gambar: "https://i.ibb.co.com/r28xv8R4/d1a5b75807086e72-1737204284987v-Mie-Ayam0316654dd34b5698e-6-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "bakso_telur", nama: "Bakso Telur", harga: 20000, gambar: "https://i.ibb.co.com/20pf12b4/b9f32af81d557220-1737204257466v-Bakso-Beranak0119654dd2106c9e8-5-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "Jus_mangga", nama: "Jus Mangga", harga: 15000, gambar: "https://i.ibb.co.com/cKbF380j/36d62b7a152ab81f-1737205858271v-Jus-Mangga0297654dd4d7371ed-3-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "Jus_Jeruk", nama: "Jus jeruk", harga: 15000, gambar: "https://i.ibb.co.com/pvsJNVbX/6dd42d4a3079c1b5-1737205864624v-Jus-Jeruk0542654dd4b05bd97-2-11zon.jpg", extra: [], status: "Aktif" }, 
                        { id: "Esteh_Manis", nama: "es teh manis", harga: 5000, gambar: "https://i.ibb.co.com/LDsWG4HN/cc408df01271b1d8-1737205872424v-Teh-Es0204654dd50ce5997-4-11zon.jpg", extra: [], status: "Aktif" }, 
                    ]       
                },
                { 
                    id: "mbaknur003", nama: "Warung Mbak Nur", jamOperasional: "Senin-minggu 14:00-20:00",
                    gambar: "https://i.ibb.co.com/bjYMqPGN/1747139892142v-WARUNGMBAKNUR030563c2a5c006520.jpg", 
                    lokasitoko: "km-8",
                    menu: [

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                        { id: "pecel_ayam", nama: "Pecel ayam", harga: 17000, gambar: "https://i.ibb.co.com/mrMH0kd0/Pecelayam.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "pecel_lele", nama: "Pecel lele", harga: 17000, gambar: "https://i.ibb.co.com/qLYgSjM3/Pecellele.jpg", extra: [{nama: "pakai nasi", harga: 5000 },{ nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "mie_ayam_bakso", nama: "mie ayam bakso", harga: 20000, gambar: "https://i.ibb.co.com/8n7KkGFZ/Mieayambakso.jpg", extra: [], status: "Aktif" }, 
                        { id: "mie_ayam", nama: "mie ayam", harga: 15000, gambar: "https://i.ibb.co.com/q3L8myYy/Mieayam.jpg", extra: [], status: "Aktif" }, 
                        { id: "bakso", nama: "bakso", harga: 15000, gambar: "https://i.ibb.co.com/vChxBwKY/Bakso.jpg", extra: [], status: "Aktif" },
                    ]
                },
                { 
                    id: "sarapan_mamah_yenni", nama: "Sarapan Mamah yenni", jamOperasional: "Senin-minggu 07:00-12:00",
                    gambar: "https://i.ibb.co.com/BVJP4dQ1/1747141321148v-Kedai-Mamah-Yenni085863be37e0c2200-1-11zon.jpg",
                    lokasitoko: "km-8",
                    menu: [
                        { id: "bubur_ayam", nama: "bubur ayam", harga: 15000, gambar: "https://i.ibb.co.com/GfSHpWqR/1747141359695v-Bubur-Ayam081463be3b28db8c1-8-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "lotek", nama: "lotek", harga: 15000, gambar: "https://i.ibb.co.com/qLnDsQvJ/1747414102878v-Lotek039263be3bce3103b-1-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Ketoprak", nama: "ketoprak", harga: 15000, gambar: "https://i.ibb.co.com/ns4bzQPX/1747141354569v-Ketoprak032963be3c75ee9a4-7-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "nasi_uduk_kuning", nama: "nasi uduk kuning", harga: 15000, gambar: "https://i.ibb.co.com/LD9sXZCz/1747141364499v-Nasi-Uduk-Kuning053063be39e1cc64d-9-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Kopi_Hitam", nama: "kopi Hitam", harga: 7000, gambar: "https://i.ibb.co.com/zhRBhDjF/1747141332391v-Kopi-Hitam026563ce2d5a89f10-6-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Teh_manis", nama: " es teh manis panas/dingin", harga: 6000, gambar: "https://i.ibb.co.com/LzD7TKZf/1747141326851v-Teh-Manis-Panas-Dan-Dingin092563ce2e2fe05bd-2-11zon.jpg", extra: [{ nama: "Panas", harga: 0},{ nama: "Dingin", harga: 0 }], status: "Aktif" },
                        { id: "Teh_tarik", nama: " Teh tarik panas/dingin", harga: 8000, gambar: "https://i.ibb.co.com/8gxbCdxS/1747141337792v-Tea-Tarikk-Panas-Dan-Dingin069963ce2ceacb745-5-11zon.jpg", extra: [{ nama: "Panas", harga: 0},{ nama: "Dingin", harga: 0 }], status: "Aktif" },
                        { id: "indocafe_cappucino", nama: " indocafe Capoucino panas/dingin", harga: 8000, gambar: "https://i.ibb.co.com/HL27NfNp/1747141343326v-Indocafe-Cappucino-Panas-Dan-Dingin021763ce2c57a91e2-3-11zon.jpg", extra: [{ nama: "Panas", harga: 0},{ nama: "Dingin", harga: 0 }], status: "Aktif" },
                        { id: "Aqua_800ml", nama: " Aqua 800 ml Biasa/dingin", harga: 5000, gambar: "https://i.ibb.co.com/xx03j6j/1747141349641v-Aqua072063cc9b0eac894-4-11zon.jpg", extra: [], status: "Aktif" },
                    ]
                },

                 { 
                    id: "sarapan_bude_yaroh", nama: "SARAPAN BUDE YAROH", jamOperasional: "Senin-minggu 07:00-12:00",
                    gambar: "https://i.ibb.co.com/mrSvS7xW/1749298442467v-SARAPANPAGIBUDEYAROH021563b94942232f5-6-11zon.jpg",
                    lokasitoko: "km-7",
                    menu: [
                        { id: "soto_ayam", nama: "soto ayam ayam", harga: 13000, gambar: "https://i.ibb.co.com/RG4Y6hgW/1749298487452v-SOTOAYAM094963b94bc7c3c50-5-11zon.jpg", extra: [], status: "Aktif" },
                       { id: "nasi_goreng_telur", nama: "nasi goreng + telur", harga: 12000, gambar: "https://i.ibb.co.com/Lzkp5q0G/1749298493092v-Nasi-Goreng018963b94b578772b-4-11zon.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" },
                        { id: "lontong_pical", nama: "lontong pical", harga: 12000, gambar: "https://i.ibb.co.com/BVFpB2PY/1749298502633v-Lontongpical083663b94ae2512ab-2-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "lontong_gulai", nama: "lontong gulai", harga: 12000, gambar: "https://i.ibb.co.com/FL0FY410/1749298497948v-Lontonggulai064763b94b142cc36-3-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Gorengan", nama: "gorengan bakwan", harga: 2000, gambar: "https://i.ibb.co.com/JWZWpVPn/1749298513663v-Gorengan-BAKWAN041363b949baee745-1-11zon.jpg", extra: [], status: "Aktif" },
                   ]
                },
                        
                        {  
                    id: "Tutiwelif", nama: "WARUNG TUTI WELIF", jamOperasional: "Senin-minggu 11:00-21:00",
                    gambar: "https://i.ibb.co.com/hxzn535n/FB-IMG-1747918688607-3-11zon.jpg", 
                    lokasitoko: "km-8",
                    menu: [

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 
                        { id: "pecel_ayam_tw", nama: "Pecel ayam", harga: 17000, gambar: "https://i.ibb.co.com/VWVgx303/1747918937814v-Pecel-Ayam064563b58658e29af-9-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "pecel_lele_tw", nama: "Pecel lele", harga: 17000, gambar: "https://i.ibb.co.com/zHNYYXgK/1747918933052v-Pecel-Lele076063b586dfbad8e-8-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 },{ nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "Sate_madura_tw", nama: "Sate Madura", harga: 18000, gambar: "https://i.ibb.co.com/jZqjCJZD/FB-IMG-1747918796134-1-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Es_Campur_tw", nama: "Es Campur", harga: 10000, gambar: "https://i.ibb.co.com/99bF3qrn/1747918925468v-Es-Campur060163b587530a3c0-7-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Jus_Alpukat_tw", nama: "Jus Alpukat", harga: 15000, gambar: "https://i.ibb.co.com/d07JbCQp/1747918920065v-Jus-Alpukat029563b5877f4525f-6-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Jus_Naga_tw", nama: "Jus Buah Naga", harga: 15000, gambar: "https://i.ibb.co.com/60Vhx37q/1747918897638v-Jus-Buah-Naga066163b58afdd4881-2-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Jus_Jeruk_tw", nama: "Jus Jeruk", harga: 10000, gambar: "https://i.ibb.co.com/pvsJNVbX/6dd42d4a3079c1b5-1737205864624v-Jus-Jeruk0542654dd4b05bd97-2-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "Capoucino_cincau_tw", nama: "Cappucino Cincau", harga: 10000, gambar: "https://i.ibb.co.com/sJKF6zNm/1747918910551v-Cappucino-Cincau087863b5886865a2b-5-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "extra_Jos_susu_tw", nama: "Extra Joss Susu", harga: 10000, gambar: "https://i.ibb.co.com/Xxg9T2yk/1747918904960v-Extra-Jos-Susu-Dingin040763b58bff09ab1-4-11zon.jpg", extra: [], status: "Aktif" },
                    ]
                },

{  id: "mbyen", nama: "ANGKRINGAN MBYEN", jamOperasional: "Senin-minggu 16:00-24:00",
                    gambar: "https://i.ibb.co.com/3msh9NW5/1747922401733v-ANGKRINGANMBYEN0597642dae8711c33-1-11zon.jpg", 
                    lokasitoko: "km-7",
                    menu: [

{ id: "ayam_geprek", nama: "Ayam Geprek Lado Hijau", harga: 18000, gambar: "https://i.ibb.co.com/TML6n9Ck/1747922348562v-Ayam-Geprek-Lado-Hijau0378642db3393a54c-4-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "nasi_goreng_telur", nama: "nasi goreng + telur", harga: 15000, gambar: "https://i.ibb.co.com/nqRb7xfd/1747922337295v-Nasi-Goreng0875642db2a0d9e59-5-11zon.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" }, 

{id: "nasgor_spesial", nama: "Nasi Goreng Ayam spesial", harga: 25000, gambar: "https://i.ibb.co.com/KzfZ7V4N/1747922359039v-Nasi-Goreng-Spesial-Pakaiayam0538642db50bd3c94-2-11zon.jpg", extra: [], status: "Aktif" },

{id: "Teh_telur_jahe", nama: "Teh telur jahe", harga: 13000, gambar: "https://i.ibb.co.com/STfHn6r/1747922321719v-Tehtelor-Jahe-Hangat0217642db1c3cc960-8-11zon.jpg", extra: [], status: "Aktif" },

{ id: "Mie_goreng_telur", nama: "Mie goreng + telur", harga: 12000, gambar: "https://i.ibb.co.com/Sw71ytVT/1747922331894v-Mie-Goreng0501642db23ce2b47-6-11zon.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" }, 

{ id: "Mie_nasi_telur", nama: "Mie nasi + telur", harga: 18000, gambar: "https://i.ibb.co.com/d0L8djDD/1747922354359v-Mie-Nasi0505642db3e2e408b-3-11zon.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" }, 

{id: "Mie_rebus_telur", nama: "Mie Rebus + telur", harga: 10000, gambar: "https://i.ibb.co.com/ync5c6JR/1747922326733v-Mie-Rebus0203642db20002df9-7-11zon.jpg", extra: [], status: "Aktif" },

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, ]  },


{  id: "martabakben", nama: "MARTABAK BABE KM6", jamOperasional: "Senin-minggu 16:00-23:00",
                    gambar: "https://i.ibb.co.com/TMGkHnL7/IMG-20250518-182401.jpg", 
                    lokasitoko: "km-6",
                    menu: [

{id: "Mie_rebus_telur", nama: "MARTABAK BANGKA", harga: 20000, gambar: 'https://i.ibb.co.com/7dzqDw8X/images-1747567405130.jpg',
            extra: [{ nama: 'Keju', harga: 3000 },{ nama: 'jagung', harga: 3000 },{ nama: 'kacang', harga: 3000 },{ nama: 'coklat', harga: 3000 },{ nama: 'Kismis', harga: 3000 },{ nama: 'wijen', harga: 3000 },{ nama: 'blueberry', harga: 3000 },{ nama: 'stroberry', harga: 3000 },{ nama: 'nanas', harga: 3000 }], status: "Aktif" }, ]  },

{  id: "bakso_pelangi", nama: "BAKSO PELANGI", jamOperasional: "Senin-minggu 14:00-20:00",
                    gambar: "https://i.ibb.co.com/434MBq5/1749124842435v-Mie-Ayam-Bakso-Pelangi-PAKDE059163b959a739288-21-11zon.jpg", 
                    lokasitoko: "km-7",
                    menu: [


{ id: "bakso_daging_sapi", nama: "Bakso daging sapi", harga: 15000, gambar: "https://i.ibb.co.com/H922ddW/1749124898767v-Bakso-Daging-Sapi074363c55c64ecdb0-20-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "bakso_original_kosong", nama: "Bakso Original kosong", harga: 15000, gambar: "https://i.ibb.co.com/B5rh9s7d/1749124904943v-Bakso-Tanpa-Mie-Bakso-Kosong096063c55b8dd3ade-19-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam", nama: "Mie Ayam", harga: 15000, gambar: "https://i.ibb.co.com/xtRPCX3S/1749124909556v-Mie-Ayam028163b95e5f35377-18-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam_bakso", nama: "Mie Ayam Bakso", harga: 20000, gambar: "https://i.ibb.co.com/v8sTKLT/1749124914446v-Mie-Ayam-Bakso093263b95a3ec8933-17-11zon.jpg", extra: [], status: "Aktif" }, 


]  },


{  id: "RM_Anuhrah", nama: "RUMAH MAKAN ANUGRAH RASA", jamOperasional: "Senin-minggu 11:00-20:00",
                    gambar: "https://i.ibb.co.com/WNN2vGmP/1748018218136v-RUMAHMAKANANUGRAHRASA061863d8e77330ecf-14-11zon.jpg", 
                    lokasitoko: "km-5",
                    menu: [

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 


{ id: "es_Teh_Manis", nama: "es teh manis", harga: 8000, gambar: "https://i.ibb.co.com/TxsM1hB1/esteh.jpg", extra: [], status: "Aktif" }, 

{ id: "teh_talua", nama: "teh Talua", harga: 10000, gambar: "https://i.ibb.co.com/23Gd1pzg/1748018225435v-Teh-Telur026063ea3fd0d54e4-13-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "Telur_Dadar", nama: "Telur Dadar", harga: 13000, gambar: "https://i.ibb.co.com/KcFyFMsj/1748018276762v-Telor-Dadar018363d8f523d6621-5-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Rendang_Sapi", nama: "Rendang daging Sapi", harga: 18000, gambar: "https://i.ibb.co.com/20m19vjR/1748018263069v-Nasi-Rendang064763ea3c67a0db5-7-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "gulai_cancang", nama: "gulai cancang", harga: 18000, gambar: "https://i.ibb.co.com/WN9ZYFGT/1748018257120v-Nasi-Gulai-Cancang053163ea3cc1b0535-8-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "dendeng_Sapi", nama: "Dendeng batokok daging Sapi", harga: 18000, gambar: "https://i.ibb.co.com/b5ZgTkrM/1748018282909v-Dendeng-Batokok089863d8f0c910e17-4-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "ikan_bakar_laut", nama: "Ikan Bakar Laut", harga: 18000, gambar: "https://i.ibb.co.com/mCR5VVF8/1748018230774v-Nasi-Ikan-Bakar-Laut029163ea3dde53f5c-12-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "ikan_bakar_nila", nama: "Ikan Bakar nila", harga: 18000, gambar: "https://i.ibb.co.com/8DGHXxzJ/1748018242583v-Nasi-Ikan-Bakar-Nila083163ea3d4c49969-10-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "ikan_goreng_baado", nama: "Ikan goreng balado", harga: 18000, gambar: "https://i.ibb.co.com/TMMBS8ZV/1748018270930v-Nasi-Ikan-Goreng014063ea3bd9afb9e-6-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Ayam_Kecap", nama: "Ayam Kecap", harga: 18000, gambar: "https://i.ibb.co.com/WpGkQPGh/1748018250451v-Nasi-Ayam-Kecap022263ea3d19b8420-9-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Ayam_gulai", nama: "Ayam gulai", harga: 18000, gambar: "https://i.ibb.co.com/Tx5vLJZq/1748018289893v-Ayam-Gulai055863d8f02c1e599-3-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Ayam_bumbu", nama: "Ayam bumbu", harga: 18000, gambar: "https://i.ibb.co.com/DfXxcWxV/1748018294410v-Ayam-Bumbu014463d8efab3ed95-2-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Ayam_goreng_lado_hijau", nama: "Ayam goreng lado hijau", harga: 18000, gambar: "https://i.ibb.co.com/Kjwg6NGg/1748018299846v-Ayam-Lado-Hijau010263d8eefc2db32-1-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 





]  },

{  id: "ilham_cafe", nama: "ILHAM CAFE", jamOperasional: "Senin-minggu 12:00-20:00",
                    gambar: "https://i.ibb.co.com/9327pftZ/1749124952373v-ILHAMCAFE065063b5997d2d5b1-16-11zon.jpg", 
                    lokasitoko: "km-7",
                    menu: [

{ id: "pecel_ayam", nama: "Pecel ayam", harga: 17000, gambar: "https://i.ibb.co.com/ZRzs7MNq/download-15-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 }, { nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 
                        { id: "pecel_lele", nama: "Pecel lele", harga: 17000, gambar: "https://i.ibb.co.com/JR70sbYL/images-1749125708333-1-11zon.jpg", extra: [{nama: "pakai nasi", harga: 5000 },{ nama: "Tanpa nasi", harga: 0 }], status: "Aktif" }, 

{ id: "Nasi_putih", nama: "Nasi Putih Tambahan", harga: 5000, gambar: "https://i.ibb.co/C3Wc34ss/download.jpg", extra: [], status: "Aktif" }, 


]  },

{  id: "mas_pentol", nama: "BAKSO MAS PENTOL", jamOperasional: "Senin-minggu 16:00-23:00",
                    gambar: "https://i.ibb.co.com/DPpW4Nxb/1749128077590v-Bakso-Mas-Pentol039163b42cb6133a6-16-11zon.jpg", 
                    lokasitoko: "km-6",
                    menu: [

{ id: "bakso_mie_telur", nama: "Bakso mie + telor", harga: 25000, gambar: "https://i.ibb.co.com/9H0m1fKz/1749128157661v-Bakso-Telor-Mie-Putih067963b698ac508c3-4-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "bakso_mie", nama: "Bakso mie", harga: 15000, gambar: "https://i.ibb.co.com/j9C1LKDx/1749128082727v-Mie-Ayam-Bakso-Mie-Putih039363b6a08a82962-15-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "bakso_kosong", nama: "Bakso kosong", harga: 15000, gambar: "https://i.ibb.co.com/VYmXMyPD/1749128162450v-Bakso-Kosong044363b697f187c48-3-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam", nama: "mie ayam", harga: 15000, gambar: "https://i.ibb.co.com/svmwBjqp/1749128146232v-Mie-Ayam098063b699bd61eff-6-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam_bakso", nama: "mie ayam Bakso", harga: 20000, gambar: "https://i.ibb.co.com/27cWXFqr/1749128141621v-Mie-Ayam-Bakso099463b69a5219191-7-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam_bakso_telur", nama: "mie ayam + Bakso telur", harga: 20000, gambar: "https://i.ibb.co.com/9HFm7kTD/1749128136399v-Mie-Ayam-Telor052663b69ada69d60-8-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "mie_ayam_komplit", nama: "mie ayam komplit", harga: 25000, gambar: "https://i.ibb.co.com/spRNSF6z/1749128103688v-Bakso-Mie-Campur018063b69f18c5bb3-12-11zon.jpg", extra: [], status: "Aktif" }, 

{ id: "Es_Teh_Manis", nama: "Es Teh Manis", harga: 8000, gambar: "https://i.ibb.co.com/Rp5tx1jx/1749128109565v-Teh-Es052663b69e4909f23-11-11zon.jpg", extra: [], status: "Aktif" }, 
]  },


{  id: "sarapan_3_putri", nama: "SARAPAN TIGA SAUDARA", jamOperasional: "Senin-minggu 06:00-12:00",
                    gambar: "https://i.ibb.co/r2h5G308/IMG-20250609-103519-11zon.jpg", 
                    lokasitoko: "km-9",
                    menu: [
 { id: "soto_ayam", nama: "soto ayam ayam + nasi", harga: 15000, gambar: "https://i.ibb.co.com/RG4Y6hgW/1749298487452v-SOTOAYAM094963b94bc7c3c50-5-11zon.jpg", extra: [], status: "Aktif" },
                      
                        { id: "lontong_gulai", nama: "lontong gulai + Telur", harga: 12000, gambar: "https://i.ibb.co.com/BVFpB2PY/1749298502633v-Lontongpical083663b94ae2512ab-2-11zon.jpg", extra: [], status: "Aktif" },
                        { id: "nasi_goreng_telur", nama: "nasi goreng + telur", harga: 12000, gambar: "https://i.ibb.co.com/Lzkp5q0G/1749298493092v-Nasi-Goreng018963b94b578772b-4-11zon.jpg", extra: [{nama: "telur mata sapi", harga: 0 }, { nama: "telur dadar", harga: 0 }], status: "Aktif" },

{ id: "Aqua_800ml", nama: " Aqua 800 ml Biasa/dingin", harga: 5000, gambar: "https://i.ibb.co.com/xx03j6j/1747141349641v-Aqua072063cc9b0eac894-4-11zon.jpg", extra: [], status: "Aktif" },

{ id: "Aqua_1500ml", nama: " Aqua 1500 ml Biasa/dingin", harga: 8000, gambar: "https://i.ibb.co.com/xx03j6j/1747141349641v-Aqua072063cc9b0eac894-4-11zon.jpg", extra: [], status: "Aktif" },


]  },
            ];

            const WHATSAPP_ADMIN = "6285266610522"; 

            // --- Element Selectors ---
            const storeListContainer = document.getElementById('store-list-container');
            const searchBar = document.getElementById('search-bar');
            const bottomNavButtons = document.querySelectorAll('#bottom-navigation .nav-button');
            const storeModal = document.getElementById('store-modal');
            const modalStoreName = document.getElementById('modal-store-name');
            const modalStoreClosedMessage = document.getElementById('modal-store-closed-message');
            const modalMenuItemsContainer = document.getElementById('modal-menu-items-container');
            const closeModalButton = storeModal.querySelector('.close-button');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartSummaryDiv = document.getElementById('cart-summary');
            const cartSubtotalSpan = document.getElementById('cart-subtotal');
            const deliveryLocationSelect = document.getElementById('delivery-location');
            const deliveryLocationDetailInput = document.getElementById('delivery-location-detail');
            const deliveryFeeSpan = document.getElementById('delivery-fee');
            const cartTotalPaymentSpan = document.getElementById('cart-total-payment');
            const sendOrderBtn = document.getElementById('send-order-btn');
            const cartCountBadge = document.getElementById('cart-count-badge');
            const emptyCartMessage = cartItemsContainer.querySelector('.empty-cart-message');
            const historyItemsContainer = document.getElementById('history-items-container');
            const emptyHistoryMessage = historyItemsContainer.querySelector('.empty-history-message');
            const toastNotification = document.getElementById('toast-notification');
            const storeCardTemplate = document.getElementById('store-card-template');
            const menuItemTemplate = document.getElementById('menu-item-template');
            const cartItemTemplate = document.getElementById('cart-item-template');
            const historyItemTemplate = document.getElementById('history-item-template');

        // --- IMAGE SLIDER LOGIC ---
        const sliderWrapper = document.querySelector('.slider-wrapper');
        if (sliderWrapper) {
            const slides = document.querySelectorAll('.slide');
            const sliderDotsContainer = document.querySelector('.slider-dots');
            let currentIndex = 0;
            let slideInterval;

            // Buat dots secara dinamis
            slides.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.classList.add('dot');
                dot.dataset.index = index;
                if (index === 0) dot.classList.add('active');
                sliderDotsContainer.appendChild(dot);
            });

            const dots = document.querySelectorAll('.dot');

            const showSlide = (index) => {
                sliderWrapper.style.transform = `translateX(-${index * 100}%)`;
                dots.forEach(d => d.classList.remove('active'));
                dots[index].classList.add('active');
            };

            const nextSlide = () => {
                currentIndex = (currentIndex + 1) % slides.length;
                showSlide(currentIndex);
            };

            const startSlider = () => {
                slideInterval = setInterval(nextSlide, 2000); // Ganti gambar setiap 2 detik
            };
            
            const resetSliderInterval = () => {
                clearInterval(slideInterval);
                startSlider();
            };

            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    currentIndex = parseInt(dot.dataset.index);
                    showSlide(currentIndex);
                    resetSliderInterval(); // Reset interval saat dot di klik
                });
            });

            startSlider();
        }


            let cart = loadCart();
            let orderHistory = loadHistory();
            let currentOpenStoreId = null;
            let currentPageId = 'home';
            let isStoreModalOpen = false;

            // --- LAZY LOADING IMAGES ---
            let imageObserver;
            const placeholderSrc = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"; // Transparent pixel

            function lazyLoadImage(img) {
                const src = img.dataset.src;
                if (!src) return;

                img.onload = () => {
                    img.classList.add('loaded');
                };
                img.onerror = () => {
                    // console.error(`Gagal memuat gambar: ${src}`);
                    img.src = placeholderSrc; 
                    img.classList.add('loaded'); 
                };
                img.src = src;
                img.removeAttribute('data-src');
            }

            function observeImage(imageElement) {
                if (imageObserver && imageElement) {
                    imageObserver.observe(imageElement);
                }
            }

// --- SCRIPT UNTUK FITUR KURIR (DARI KODE DUA) ---
// Deklarasi variabel dengan ID yang sudah diganti
const serviceBtns = document.querySelectorAll('.service-btn');
const pickupLabel = document.getElementById('pickup-label');
const pickupLocationEl = document.getElementById('pickup-location');
const pickupDetailEl = document.getElementById('pickup-detail');
const dropoffLocationEl = document.getElementById('dropoff-location');
const dropoffDetailEl = document.getElementById('dropoff-detail');
const scheduleTypeRadios = document.querySelectorAll('input[name="schedule-type"]');
const scheduleSection = document.getElementById('schedule-section');
const scheduleDateTimeEl = document.getElementById('schedule-datetime');
const totalCostEl = document.getElementById('total-cost');
const submitBtnKurir = document.getElementById('submit-order-kurir');
const historyListKurirEl = document.getElementById('history-list-kurir');
const clearHistoryBtnKurir = document.getElementById('clear-history-btn-kurir');

const titipBeliOptions = document.getElementById('titip-beli-options');
const shoppingListContainer = document.getElementById('shopping-list-container');
const shoppingCostEl = document.getElementById('shopping-cost');

const kirimBarangOptions = document.getElementById('kirim-barang-options');
const itemInfoEl = document.getElementById('item-info');
const codStatusRadios = document.querySelectorAll('input[name="cod-status"]');
const codCostSection = document.getElementById('cod-cost-section');
const codCostEl = document.getElementById('cod-cost');
const shippingPayerRadios = document.querySelectorAll('input[name="shipping-payer"]');

const ojekOptions = document.getElementById('ojek-options');
const ojekNotesEl = document.getElementById('ojek-notes');

let selectedService = '';
const ADMIN_PHONE_NUMBER_KURIR = '6285266610522';

// Tidak perlu fungsi showToast baru, kita bisa pakai yang sudah ada di Kode Satu
// showToast(message, type);

function calculateFare() {
    const pickupKm = parseFloat(pickupLocationEl.value);
    const dropoffKm = parseFloat(dropoffLocationEl.value);
    if (isNaN(pickupKm) || isNaN(dropoffKm) || !selectedService) return 0;

    const distance = Math.abs(pickupKm - dropoffKm);
    let baseFare = 0, costPerKm = 1500, baseDistance = 2;
    switch (selectedService) {
        case 'Titip Beli': baseFare = 6000; break;
        case 'Kirim Barang': baseFare = 5000; break;
        case 'Ojek': baseFare = 7000; break;
    }
    let deliveryFee = (distance <= baseDistance) ? baseFare : baseFare + (distance - baseDistance) * costPerKm;
    const pickupIsOther = pickupLocationEl.options[pickupLocationEl.selectedIndex]?.text.includes('(Other)');
    const dropoffIsOther = dropoffLocationEl.options[dropoffLocationEl.selectedIndex]?.text.includes('(Other)');
    if (pickupIsOther || dropoffIsOther) deliveryFee += 3000;
    return deliveryFee;
}

function updateTotalKurir() {
    const deliveryFee = calculateFare();
    let additionalCost = 0;
    if (selectedService === 'Titip Beli') {
        additionalCost = parseFloat(shoppingCostEl.value) || 0;
    } else if (selectedService === 'Kirim Barang' && document.querySelector('input[name="cod-status"]:checked')?.value === 'Belum Lunas (COD)') {
        additionalCost = parseFloat(codCostEl.value) || 0;
    }
    const total = deliveryFee + additionalCost;
    totalCostEl.textContent = formatPrice(total); // Menggunakan fungsi formatPrice dari Kode Satu
}

function handleServiceSelection(e) {
    serviceBtns.forEach(btn => btn.classList.remove('active'));
    const clickedBtn = e.target.closest('.service-btn');
    if (!clickedBtn) return;
    clickedBtn.classList.add('active');
    selectedService = clickedBtn.dataset.service;

    titipBeliOptions.classList.add('hidden');
    kirimBarangOptions.classList.add('hidden');
    ojekOptions.classList.add('hidden');
    
    switch (selectedService) {
        case 'Titip Beli':
            pickupLabel.textContent = 'Lokasi Belanja';
            pickupDetailEl.placeholder = 'Detail Lokasi Belanja, Cth: Kedai Maskus';
            titipBeliOptions.classList.remove('hidden');
            break;
        case 'Kirim Barang':
            pickupLabel.textContent = 'Lokasi Jemput';
            pickupDetailEl.placeholder = 'Detail Lokasi jemput, Cth: Depan kantor pos';
            kirimBarangOptions.classList.remove('hidden');
            break;
        case 'Ojek':
            pickupLabel.textContent = 'Lokasi Jemput';
            pickupDetailEl.placeholder = 'Detail lokasi jemput, Cth: Depan Bank Nagari';
            ojekOptions.classList.remove('hidden');
            break;
    }
    updateTotalKurir();
}

function handleCodStatusChange() {
    codCostSection.classList.toggle('hidden', document.querySelector('input[name="cod-status"]:checked').value !== 'Belum Lunas (COD)');
    if(document.querySelector('input[name="cod-status"]:checked').value === 'Sudah Lunas') codCostEl.value = '';
    updateTotalKurir();
}

function handleShoppingListInput(e) {
    if (e.target.classList.contains('shopping-item-name')) {
        const currentRow = e.target.closest('.shopping-item-row');
        const allRows = Array.from(shoppingListContainer.querySelectorAll('.shopping-item-row')).filter(row => !row.classList.contains('shopping-item-header'));
        const lastRow = allRows[allRows.length - 1];
        if (currentRow === lastRow && e.target.value.trim() !== '') {
            addShoppingListItem();
        }
    }
}

function addShoppingListItem(item = { name: '', qty: '', unit: '' }) {
    const itemCount = shoppingListContainer.querySelectorAll('.shopping-item-row').length;
    const newRow = document.createElement('div');
    newRow.classList.add('shopping-item-row');
    newRow.innerHTML = `
        <span>${itemCount}.</span>
        <input type="text" class="form-control shopping-item-name" placeholder="Nama Barang" value="${item.name}">
        <input type="number" class="form-control shopping-item-qty" placeholder="Jml" value="${item.qty}">
        <input type="text" class="form-control shopping-item-unit" placeholder="keterangan" value="${item.unit}">
    `;
    shoppingListContainer.appendChild(newRow);
}

function handleScheduleChange() {
    scheduleSection.classList.toggle('hidden', document.querySelector('input[name="schedule-type"]:checked').value !== 'nanti');
    if(document.querySelector('input[name="schedule-type"]:checked').value === 'nanti') {
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        scheduleDateTimeEl.min = now.toISOString().slice(0, 16);
    }
}

function loadHistoryKurir() {
    const history = JSON.parse(localStorage.getItem('sifoodOrderHistoryKurir')) || [];
    historyListKurirEl.innerHTML = '';
    clearHistoryBtnKurir.classList.toggle('hidden', history.length === 0);

    history.forEach(order => {
        const li = document.createElement('li');
        li.classList.add('history-item');
        li.dataset.orderId = order.id;

        let detailsHtml = '';
        if (order.service === 'Titip Beli') {
            let shoppingListHtml = '';
            if (order.shoppingList && order.shoppingList.length > 0) {
                shoppingListHtml = `<ul>${order.shoppingList.map(item => `<li>${item.qty} ${item.unit} ${item.name}</li>`).join('')}</ul>`;
            }
            const shoppingCostInfo = order.shoppingCost > 0 ? `<p><strong>Perkiraan Belanja:</strong> ${formatPrice(order.shoppingCost)}</p>` : '';
            detailsHtml = `<div class="details-block">${shoppingListHtml}${shoppingCostInfo}</div>`;
        } else if (order.service === 'Kirim Barang') {
            const codInfo = order.codCost > 0 ? `<p><strong>Jumlah COD:</strong> ${formatPrice(order.codCost)}</p>` : '';
            const shippingPayerInfo = `<p><strong>Ongkir Dibayar:</strong> ${order.shippingPayer}</p>`;
            detailsHtml = `<div class="details-block"><p><strong>Info Barang:</strong> ${order.itemInfo}</p>${shippingPayerInfo}<p><strong>Status Bayar:</strong> ${order.codStatus}</p>${codInfo}</div>`;
        } else if (order.service === 'Ojek' && order.ojekNotes) {
            detailsHtml = `<div class="details-block"><p><strong>Catatan:</strong> ${order.ojekNotes}</p></div>`;
        }

        li.innerHTML = `
            <button class="reorder-btn">Order Ulang</button>
            <p><strong>Dipesan:</strong> ${order.timestamp}</p>
            <p><strong>Jadwal:</strong> ${order.scheduleInfo}</p>
            <p><strong>Layanan:</strong> ${order.service}</p>
            <p><strong>${order.service === 'Titip Beli' ? 'Belanja' : 'Jemput'}:</strong> ${order.pickupLocation.text} (${order.pickupDetail})</p>
            <p><strong>Antar:</strong> ${order.dropoffLocation.text} (${order.dropoffDetail})</p>
            ${detailsHtml}
        `;
        historyListKurirEl.appendChild(li);
    });
}

function saveOrderToHistoryKurir(orderData) {
    let history = JSON.parse(localStorage.getItem('sifoodOrderHistoryKurir')) || [];
    const newOrder = { ...orderData, id: new Date().getTime() };
    history.unshift(newOrder); 
    if (history.length > 10) history.pop();
    localStorage.setItem('sifoodOrderHistoryKurir', JSON.stringify(history));
    loadHistoryKurir();
}

function handleHistoryClickKurir(e) {
    if (!e.target.classList.contains('reorder-btn')) return;

    const orderId = e.target.closest('.history-item').dataset.orderId;
    const history = JSON.parse(localStorage.getItem('sifoodOrderHistoryKurir')) || [];
    const order = history.find(o => o.id == orderId);

    if (!order) {
        return showToast('Gagal memuat data pesanan lama.', 'error');
    }

    const serviceBtnToClick = document.querySelector(`.service-btn[data-service="${order.service}"]`);
    if (serviceBtnToClick) {
        serviceBtnToClick.click();
    } else {
        return;
    }

    pickupLocationEl.value = order.pickupLocation.value;
    pickupDetailEl.value = order.pickupDetail;
    dropoffLocationEl.value = order.dropoffLocation.value;
    dropoffDetailEl.value = order.dropoffDetail;

    if (order.scheduleType === 'nanti' && order.scheduleDateTime) {
        document.querySelector('input[name="schedule-type"][value="nanti"]').checked = true;
        scheduleDateTimeEl.value = order.scheduleDateTime;
    } else {
        document.querySelector('input[name="schedule-type"][value="sekarang"]').checked = true;
    }
    handleScheduleChange();

    if (order.service === 'Titip Beli') {
        shoppingCostEl.value = order.shoppingCost || '';
        shoppingListContainer.innerHTML = `<div class="shopping-item-row shopping-item-header"><span>No.</span><span>Nama Barang</span><span>Jumlah</span><span>keterangan</span></div>`;
        if (order.shoppingList && order.shoppingList.length > 0) {
            order.shoppingList.forEach(item => addShoppingListItem(item));
        }
        addShoppingListItem(); 

    } else if (order.service === 'Kirim Barang') {
        itemInfoEl.value = order.itemInfo;
        document.querySelector(`input[name="shipping-payer"][value="${order.shippingPayer}"]`).checked = true;
        document.querySelector(`input[name="cod-status"][value="${order.codStatus}"]`).checked = true;
        
        handleCodStatusChange();
        if (order.codStatus === 'Belum Lunas (COD)') {
            codCostEl.value = order.codCost;
        }
    } else if (order.service === 'Ojek') {
        ojekNotesEl.value = order.ojekNotes || '';
    }
    
    updateTotalKurir();
    window.scrollTo({ top: 0, behavior: 'smooth' }); 
    showToast('Data pesanan telah berhasil dimuat ulang.', 'success');
}

function clearHistoryKurir() {
    if (confirm('Anda yakin ingin menghapus semua riwayat pesanan kurir?')) {
        localStorage.removeItem('sifoodOrderHistoryKurir');
        loadHistoryKurir();
    }
}

function submitOrderKurir() {
    const orderState = {}; 

    if (!selectedService) return showToast('PENTING: Pilih jenis layanan terlebih dahulu!', 'error');
    
    const pickupLocText = pickupLocationEl.options[pickupLocationEl.selectedIndex]?.text;
    const dropoffLocText = dropoffLocationEl.options[dropoffLocationEl.selectedIndex]?.text;
    
    if (!pickupLocationEl.value) return showToast(`PENTING: Pilih lokasi ${selectedService === 'Titip Beli' ? 'belanja' : 'jemput'}!`, 'error');
    if (!pickupDetailEl.value.trim()) return showToast(`PENTING: Isi detail lokasi ${selectedService === 'Titip Beli' ? 'belanja' : 'jemput'}! (Contoh: Nama Toko/Patokan)`, 'error');
    if (!dropoffLocationEl.value) return showToast('PENTING: Pilih lokasi antar!', 'error');
    if (!dropoffDetailEl.value.trim()) return showToast('PENTING: Isi detail lokasi antar! (Contoh: Nama Jalan/Nomor Rumah)', 'error');
    
    const scheduleType = document.querySelector('input[name="schedule-type"]:checked').value;
    if (scheduleType === 'nanti' && !scheduleDateTimeEl.value) return showToast('PENTING: Pilih tanggal dan jam pengantaran untuk pesanan terjadwal!', 'error');

    orderState.service = selectedService;
    orderState.timestamp = new Date().toLocaleString('id-ID', { dateStyle: 'long', timeStyle: 'short' }).replace(/\./g, ':');
    orderState.scheduleInfo = (scheduleType === 'nanti')
        ? new Date(scheduleDateTimeEl.value).toLocaleString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' }).replace(/\./g, ':')
        : 'Sekarang';
    orderState.pickupLocation = { value: pickupLocationEl.value, text: pickupLocText };
    orderState.pickupDetail = pickupDetailEl.value.trim();
    orderState.dropoffLocation = { value: dropoffLocationEl.value, text: dropoffLocText };
    orderState.dropoffDetail = dropoffDetailEl.value.trim();
    
    orderState.scheduleType = scheduleType;
    if (scheduleType === 'nanti') {
        orderState.scheduleDateTime = scheduleDateTimeEl.value;
    }
    
    let totalCostForMessage = calculateFare();
    let additionalDetails = '';

    switch (selectedService) {
        case 'Titip Beli':
            const shoppingItems = [];
            const rows = shoppingListContainer.querySelectorAll('.shopping-item-row');
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const nameEl = row.querySelector('.shopping-item-name');
                const qtyEl = row.querySelector('.shopping-item-qty');
                const unitEl = row.querySelector('.shopping-item-unit');
                
                const name = nameEl.value.trim();
                const qty = qtyEl.value.trim();
                const unit = unitEl.value.trim();
                
                if (name || qty || unit) {
                    if (!name) return showToast(`Lengkapi Belanjaan: Nama barang di baris ${i} wajib diisi!`, 'error');
                    if (!qty) return showToast(`Lengkapi Belanjaan: Jumlah untuk "${name}" wajib diisi!`, 'error');
                    if (!unit) return showToast(`Lengkapi Belanjaan: Keterangan untuk "${name}" wajib diisi! (cth: pcs, kg, liter)`, 'error');
                    shoppingItems.push({ name, qty, unit });
                }
            }

            if (shoppingItems.length === 0) return showToast('PENTING: Daftar belanjaan tidak boleh kosong! Isi minimal satu barang.', 'error');
            
            const shoppingCost = parseFloat(shoppingCostEl.value) || 0;
            if (shoppingCost <= 0) return showToast('PENTING: Perkiraan total harga belanja wajib diisi dengan angka yang benar!', 'error');
            
            orderState.shoppingList = shoppingItems;
            orderState.shoppingCost = shoppingCost;
            
            shoppingItems.forEach(item => { additionalDetails += `- ${item.name} (${item.qty} ${item.unit})\n`; });
            additionalDetails += `\n*PERKIRAAN BELANJA: ${formatPrice(shoppingCost)}*\n`;
            totalCostForMessage += shoppingCost;
            break;

        case 'Kirim Barang':
            const itemInfo = itemInfoEl.value.trim();
            if (!itemInfo) return showToast('PENTING: Informasi barang yang akan dikirim wajib diisi!', 'error');
            orderState.itemInfo = itemInfo;
            
            orderState.codStatus = document.querySelector('input[name="cod-status"]:checked').value;
            orderState.shippingPayer = document.querySelector('input[name="shipping-payer"]:checked').value;

            additionalDetails += `*Info Barang:* ${orderState.itemInfo}\n`;
            additionalDetails += `*Ongkir Dibayar Oleh:* ${orderState.shippingPayer}\n`;
            additionalDetails += `*Status Bayar Barang:* ${orderState.codStatus}\n`;

            if (orderState.codStatus === 'Belum Lunas (COD)') {
                const codCost = parseFloat(codCostEl.value) || 0;
                if (codCost <= 0) return showToast('PENTING: Jumlah COD wajib diisi dengan angka yang benar!', 'error');
                orderState.codCost = codCost;
                additionalDetails += `*JUMLAH COD: ${formatPrice(codCost)}*\n`;
                totalCostForMessage += codCost;
            } else {
                orderState.codCost = 0;
            }
            break;
        case 'Ojek':
            const ojekNotes = ojekNotesEl.value.trim();
            if (!ojekNotes) return showToast('PENTING: Catatan untuk Ojek wajib diisi! (Cth: "Tunggu di depan gerbang", "Pakai helm")', 'error');
            orderState.ojekNotes = ojekNotes;
            additionalDetails += `*Catatan:* ${orderState.ojekNotes}\n`;
            break;
    }
    
    let message = `*===== ORDER BARU | SIFOOD KURIR =====*\n\n`;
    message += `*LAYANAN :* _${orderState.service}_\n`;
    message += `*WAKTU ORDER :* _${orderState.timestamp}_\n`;
    message += `*JADWAL ANTAR :* _${orderState.scheduleInfo}_\n\n`;
    message += `*------------------------------------*\n\n`;
    message += `*▶️ ${selectedService === 'Titip Beli' ? 'LOKASI BELANJA' : 'JEMPUT DARI'}:*\n`;
    message += `*Lokasi Utama:* ${orderState.pickupLocation.text}\n`;
    message += `*Detail/Patokan:* ${orderState.pickupDetail}\n\n`;
    message += `*▶️ ANTAR KE:*\n`;
    message += `*Lokasi Utama:* ${orderState.dropoffLocation.text}\n`;
    message += `*Detail/Patokan:* ${orderState.dropoffDetail}\n\n`;
    message += `*▶️ DETAIL PESANAN:*\n`;
    message += `${additionalDetails}\n`;
    message += `*------------------------------------*\n\n`;
    message += `*RINCIAN BIAYA*\n`;
    message += `*Ongkos Kirim:* ${formatPrice(calculateFare())}\n`;
    if (orderState.service === 'Titip Beli') message += `*Perkiraan Belanja:* ${formatPrice(orderState.shoppingCost)}\n`;
    if (orderState.service === 'Kirim Barang' && orderState.codCost > 0) message += `*Jumlah COD:* ${formatPrice(orderState.codCost)}\n`;
    message += `*TOTAL ESTIMASI AKHIR: ${formatPrice(totalCostForMessage)}*\n\n`;
    message += `Terima Kasih telah menggunakan layanan Sifood! Orderan Anda akan segera kami proses. Mohon untuk standby. 🙏`;

    saveOrderToHistoryKurir(orderState);
    const whatsappUrl = `https://wa.me/${ADMIN_PHONE_NUMBER_KURIR}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

// Event Listeners Kurir
serviceBtns.forEach(btn => btn.addEventListener('click', handleServiceSelection));
[pickupLocationEl, dropoffLocationEl, shoppingCostEl, codCostEl].forEach(el => {
    if (el) el.addEventListener('input', updateTotalKurir);
});
codStatusRadios.forEach(radio => radio.addEventListener('change', handleCodStatusChange));
scheduleTypeRadios.forEach(radio => radio.addEventListener('change', handleScheduleChange));
if (shoppingListContainer) shoppingListContainer.addEventListener('input', handleShoppingListInput);
if (submitBtnKurir) submitBtnKurir.addEventListener('click', submitOrderKurir);
if (historyListKurirEl) historyListKurirEl.addEventListener('click', handleHistoryClickKurir);
if (clearHistoryBtnKurir) clearHistoryBtnKurir.addEventListener('click', clearHistoryKurir);

// Inisialisasi Kurir
loadHistoryKurir();
// --- AKHIR SCRIPT FITUR KURIR ---

            
            function initializeImageObserver() {
                if ('IntersectionObserver' in window) {
                    imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                lazyLoadImage(entry.target);
                                observer.unobserve(entry.target);
                            }
                        });
                    }, { rootMargin: "0px 0px 200px 0px" }); // Mulai load 200px sebelum masuk viewport
                } else {
                    // Fallback: load semua gambar yang punya data-src jika IntersectionObserver tidak didukung
                    document.querySelectorAll('.lazy-image[data-src]').forEach(img => lazyLoadImage(img));
                }
            }

            // --- UTILITY FUNCTIONS ---
            function formatPrice(amount) { return `Rp ${amount.toLocaleString('id-ID')}`; }
            function showToast(message, type = 'info', duration = 3000) {
                toastNotification.textContent = message;
                toastNotification.className = 'toast show';
                if (type === 'success') toastNotification.classList.add('success');
                else if (type === 'error') toastNotification.classList.add('error');
                setTimeout(() => { toastNotification.className = 'toast'; }, duration);
            }
            function getKmValueFromString(kmString) {
                if (typeof kmString !== 'string') return null;
                const match = kmString.match(/km-(\d+)/);
                return match ? parseInt(match[1]) : null;
            }
            function isStoreOpen(jamOperasional) {
                 if (!jamOperasional || typeof jamOperasional !== 'string') return true; 
                const now = new Date(); const currentDay = now.getDay(); 
                const currentTime = now.getHours() * 100 + now.getMinutes(); 

                const parts = jamOperasional.split(" "); if (parts.length < 2) return true; 
                const daysRange = parts[0]; const timeRange = parts[1];

                const timeParts = timeRange.split("-"); if (timeParts.length < 2) return true; 
                const openTime = parseInt(timeParts[0].replace(":", ""));
                const closeTime = parseInt(timeParts[1].replace(":", ""));
                if (isNaN(openTime) || isNaN(closeTime)) return true; 

                const dayMap = { "minggu": 0, "senin": 1, "selasa": 2, "rabu": 3, "kamis": 4, "jumat": 5, "sabtu": 6 };
                let isOpenDay = false;
                if (daysRange.includes("-")) { 
                    const [startDayStr, endDayStr] = daysRange.toLowerCase().split("-");
                    const startDay = dayMap[startDayStr]; const endDay = dayMap[endDayStr];
                    if (startDay === undefined || endDay === undefined) return true; 

                    if (startDay <= endDay) isOpenDay = currentDay >= startDay && currentDay <= endDay;
                    else isOpenDay = currentDay >= startDay || currentDay <= endDay; 
                } else { 
                    const singleDay = dayMap[daysRange.toLowerCase()];
                    if (singleDay === undefined) return true; 
                    isOpenDay = currentDay === singleDay;
                }

                if (!isOpenDay) return false;

                if (openTime <= closeTime) return currentTime >= openTime && currentTime < closeTime;
                else return currentTime >= openTime || currentTime < closeTime; 
            }

            // --- LOCAL STORAGE ---
            function saveCart() { localStorage.setItem('foodOrderCart', JSON.stringify(cart)); updateCartBadge(); }
            function loadCart() { const storedCart = localStorage.getItem('foodOrderCart'); return storedCart ? JSON.parse(storedCart) : []; }
            function saveHistory() { localStorage.setItem('foodOrderHistory', JSON.stringify(orderHistory)); }
            function loadHistory() { const storedHistory = localStorage.getItem('foodOrderHistory'); return storedHistory ? JSON.parse(storedHistory) : []; }

            // --- NAVIGATION & MODAL HANDLING ---
            function showPage(pageIdToShow) {
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active-page'));
                const targetPage = document.getElementById(`page-${pageIdToShow}`);
                if (targetPage) targetPage.classList.add('active-page');
                bottomNavButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.page === pageIdToShow));
                currentPageId = pageIdToShow;
                if (!history.state || history.state.page !== pageIdToShow || (history.state.modal && isStoreModalOpen) ) { 
                    // Hanya push state jika page berubah ATAU jika modal tidak seharusnya ada di state ini
                    if (isStoreModalOpen && history.state && history.state.modal) {
                        // Jika modal terbuka, state URL harus sudah merefleksikan modal
                    } else {
                        history.pushState({ page: pageIdToShow }, `Page ${pageIdToShow}`, `#${pageIdToShow}`);
                    }
                }
                if (pageIdToShow === 'keranjang') renderCart();
                if (pageIdToShow === 'riwayat') renderHistory();
            }

            function openMenuModal(storeId) {
                // showAppLoader(); // Opsional
                const store = storesData.find(s => s.id === storeId); 
                if (!store) { 
                    // hideAppLoader(); // Opsional
                    return; 
                }
                currentOpenStoreId = storeId;
                modalStoreName.textContent = store.nama;
                modalMenuItemsContainer.innerHTML = ''; // Clear previous items
                const storeCurrentlyOpen = isStoreOpen(store.jamOperasional);
                modalStoreClosedMessage.style.display = storeCurrentlyOpen ? 'none' : 'block';

                const fragment = document.createDocumentFragment();
                store.menu.forEach(menuItem => {
                    const itemCard = menuItemTemplate.content.cloneNode(true).querySelector('.menu-item-card');
                    itemCard.dataset.menuId = menuItem.id;
                    
                    const imgElement = itemCard.querySelector('.menu-image');
                    imgElement.dataset.src = menuItem.gambar; 
                    
                    itemCard.querySelector('.menu-name').textContent = menuItem.nama;
                    itemCard.querySelector('.menu-price').textContent = formatPrice(menuItem.harga);

                    const extrasSelect = itemCard.querySelector('.menu-item-extras-select');
                    extrasSelect.innerHTML = '';
                    const uniqueSelectId = `extras-select-${menuItem.id}-${Date.now()}`;
                    extrasSelect.id = uniqueSelectId;
                    itemCard.querySelector('label[for="menu-item-extras-select-template"]').setAttribute('for', uniqueSelectId);

                    if (menuItem.extra && menuItem.extra.length > 0) {
                        menuItem.extra.forEach((extra) => {
                            const option = document.createElement('option');
                            option.value = `${extra.nama}|${extra.harga}`;
                            option.textContent = `${extra.nama} (${formatPrice(extra.harga)})`;
                            option.dataset.name = extra.nama;
                            option.dataset.price = extra.harga;
                            extrasSelect.appendChild(option);
                        });
                        extrasSelect.closest('.menu-extras').style.display = 'block';
                    } else {
                        extrasSelect.closest('.menu-extras').style.display = 'none'; // Sembunyikan jika tidak ada extra
                    }


                    const addToCartButton = itemCard.querySelector('.add-to-cart-btn');
                    if (menuItem.status.toLowerCase() !== 'aktif' || !storeCurrentlyOpen) {
                        itemCard.classList.add(menuItem.status.toLowerCase() !== 'aktif' ? 'inactive' : 'store-closed');
                        addToCartButton.disabled = true;
                        extrasSelect.disabled = true;
                    } else {
                        extrasSelect.disabled = false;
                    }

                    const qtyValueSpan = itemCard.querySelector('.qty-value');
                    const subtotalSpan = itemCard.querySelector('.menu-subtotal');
                    const minusBtn = itemCard.querySelector('.qty-btn.minus');
                    const plusBtn = itemCard.querySelector('.qty-btn.plus');

                    function updateItemSubtotal() {
                        let currentQty = parseInt(qtyValueSpan.textContent);
                        let basePrice = menuItem.harga;
                        let extrasPrice = 0;
                        Array.from(extrasSelect.selectedOptions).forEach(optionNode => {
                            extrasPrice += parseInt(optionNode.dataset.price);
                        });
                        const totalItemPrice = (basePrice + extrasPrice) * currentQty;
                        subtotalSpan.textContent = formatPrice(totalItemPrice);
                        minusBtn.disabled = currentQty <= 1;
                    }

                    extrasSelect.addEventListener('change', updateItemSubtotal);
                    minusBtn.addEventListener('click', () => { if (parseInt(qtyValueSpan.textContent) > 1) { qtyValueSpan.textContent = parseInt(qtyValueSpan.textContent) - 1; updateItemSubtotal(); }});
                    plusBtn.addEventListener('click', () => { qtyValueSpan.textContent = parseInt(qtyValueSpan.textContent) + 1; updateItemSubtotal(); });
                    updateItemSubtotal();

                    addToCartButton.addEventListener('click', () => {
                        const currentStore = storesData.find(s => s.id === currentOpenStoreId);
                        if (!currentStore || !isStoreOpen(currentStore.jamOperasional)) { showToast('Toko sedang tutup.', 'error'); return; }
                        if (cart.length > 0 && cart[0].storeId !== store.id) { showToast('Hanya bisa Order dari satu toko. Kosongkan keranjang dahulu.', 'error'); return; }

                        const selectedOptionsNodes = Array.from(extrasSelect.selectedOptions);
                        
                        // MODIFIED LOGIC FOR EXTRA SELECTION:
                        // Jika menu item memiliki opsi extra (menuItem.extra ada dan tidak kosong),
                        // maka pengguna wajib memilih minimal satu opsi extra.
                        if (menuItem.extra && menuItem.extra.length > 0) {
                            if (selectedOptionsNodes.length === 0) {
                                showToast('Menu ini memiliki opsi Extra. Silakan pilih minimal satu.', 'error');
                                extrasSelect.focus();
                                return;
                            }
                        }
                        // Akhir modifikasi logika extra

                        const selectedExtras = selectedOptionsNodes.map(optionNode => ({
                            name: optionNode.dataset.name,
                            price: parseInt(optionNode.dataset.price)
                        }));
                        const quantity = parseInt(qtyValueSpan.textContent);
                        const notes = itemCard.querySelector('.menu-notes').value.trim();
                        
                        // Urutkan extra yang dipilih untuk konsistensi saat pengecekan duplikat
                        const sortedSelectedExtras = selectedExtras.sort((a,b) => a.name.localeCompare(b.name));

                        const existingItemIndex = cart.findIndex(item =>
                            item.menuId === menuItem.id && item.storeId === store.id &&
                            JSON.stringify(item.extras.sort((a,b) => a.name.localeCompare(b.name))) === JSON.stringify(sortedSelectedExtras) &&
                            item.notes === notes 
                        );

                        if (existingItemIndex > -1) { 
                            showToast(`${menuItem.nama} sudah ada di keranjang dengan extra dan catatan yang sama. Anda dapat mengubah jumlahnya di halaman keranjang atau mengubah catatan/extra di sini untuk item baru.`, 'info', 5000); 
                            return; 
                        }

                        cart.push({
                            id: `${store.id}-${menuItem.id}-${Date.now()}`, storeId: store.id, storeName: store.nama,
                            menuId: menuItem.id, menuName: menuItem.nama, menuImage: menuItem.gambar, 
                            basePrice: menuItem.harga, extras: sortedSelectedExtras, quantity: quantity, notes: notes,
                            orderTime: new Date().toISOString()
                        });
                        saveCart();
                        showToast(`${menuItem.nama} berhasil ditambahkan!`, 'success');
                    });
                    fragment.appendChild(itemCard);
                });
                modalMenuItemsContainer.appendChild(fragment);
                modalMenuItemsContainer.querySelectorAll('.lazy-image[data-src]').forEach(img => observeImage(img));

                storeModal.style.display = 'block'; isStoreModalOpen = true;
                if (!history.state || !history.state.modal || history.state.storeId !== store.id) {
                    history.pushState({ modal: 'storeMenuOpen', storeId: store.id, pageBeforeModal: currentPageId }, "Menu Toko", `#${currentPageId}/toko/${store.id}`);
                }
                // hideAppLoader(); // Opsional
            }

            function closeMenuModal() {
                storeModal.style.display = 'none'; isStoreModalOpen = false; currentOpenStoreId = null;
                if (history.state && history.state.modal === 'storeMenuOpen') {
                     // Go back to the state before modal was opened
                     // This assumes the 'pageBeforeModal' was correctly set and the URL hash matches it.
                     // If history.back() causes issues, might need to explicitly navigate to `#${history.state.pageBeforeModal}`
                     history.back(); 
                }
            }
            closeModalButton.addEventListener('click', closeMenuModal);
            window.addEventListener('click', (event) => { if (event.target == storeModal) closeMenuModal(); });

            bottomNavButtons.forEach(button => {
    button.addEventListener('click', () => {
        const pageName = button.dataset.page;
        if (currentPageId !== pageName) {
            showPage(pageName);
        }
    });
});


            window.addEventListener('popstate', (event) => {
                const state = event.state;
                if (isStoreModalOpen && (!state || !state.modal)) { 
                    // If modal is open, but browser back leads to a state without modal, close it.
                    storeModal.style.display = 'none'; 
                    isStoreModalOpen = false; 
                    currentOpenStoreId = null;
                    // The current page should be what's in the state or derived from hash
                    const hashPage = window.location.hash.substring(1).split('/')[0];
                    currentPageId = (state && state.page) ? state.page : (hashPage || 'home');
                    bottomNavButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.page === currentPageId));
                    return;
                }

                if (state && state.page) {
                    showPage(state.page); 
                    if (state.modal === 'storeMenuOpen' && state.storeId && !isStoreModalOpen) {
                        // If state indicates modal should be open, but it's not, open it.
                        // This handles forward navigation back to a modal state.
                        openMenuModal(state.storeId);
                    }
                } else if (!state && location.hash === "") { 
                     showPage('home');
                } else if (location.hash) {
                    const hashParts = window.location.hash.substring(1).split('/');
                    const pageFromUrl = hashParts[0];
                    const validPagesForDirectNav = ['home', 'keranjang', 'riwayat'];
                    if (validPagesForDirectNav.includes(pageFromUrl)) {
                        showPage(pageFromUrl);
                         if (hashParts.length > 2 && hashParts[1] === 'toko' && hashParts[2] && !isStoreModalOpen) {
                            const storeIdFromUrl = hashParts[2];
                            const storeExists = storesData.find(s => s.id === storeIdFromUrl);
                            if (storeExists) {
                                setTimeout(() => openMenuModal(storeIdFromUrl), 50); 
                            }
                        }
                    } else {
                        showPage('home');
                    }
                } else {
                     showPage('home');
                }
            });

            // --- HOME PAGE ---
            function renderStores(filterText = "") {
                storeListContainer.innerHTML = '';
                const lowerFilterText = filterText.toLowerCase();
                const filteredStores = storesData.filter(store =>
                    store.nama.toLowerCase().includes(lowerFilterText) ||
                    store.menu.some(menuItem => menuItem.nama.toLowerCase().includes(lowerFilterText))
                );
                if (filteredStores.length === 0) { storeListContainer.innerHTML = '<p>Tidak ada toko atau menu yang cocok.</p>'; return; }
                
                const fragment = document.createDocumentFragment();
                filteredStores.forEach(store => {
                    const card = storeCardTemplate.content.cloneNode(true).querySelector('.store-card');
                    card.dataset.storeId = store.id;
                    
                    const imgElement = card.querySelector('.store-image');
                    imgElement.dataset.src = store.gambar;  
                    
                    card.querySelector('.store-name').textContent = store.nama;
                    card.querySelector('.store-hours').textContent = `Jam: ${store.jamOperasional}`;
                    const overlay = card.querySelector('.store-status-overlay');
                    if (!isStoreOpen(store.jamOperasional)) { card.classList.add('closed'); overlay.style.display = 'flex'; }
                    else { overlay.style.display = 'none'; }
                    card.addEventListener('click', () => openMenuModal(store.id));
                    fragment.appendChild(card);
                });
                storeListContainer.appendChild(fragment);
                storeListContainer.querySelectorAll('.lazy-image[data-src]').forEach(img => observeImage(img));
            }
            searchBar.addEventListener('input', (e) => renderStores(e.target.value));

            // --- CART PAGE ---
            function renderCart() {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    if (emptyCartMessage) emptyCartMessage.style.display = 'block';
                    cartSummaryDiv.style.display = 'none';
                    deliveryLocationSelect.value = ""; deliveryLocationDetailInput.value = "";
                    updateCartBadge(); updateCartSummary(); return;
                }
                if (emptyCartMessage) emptyCartMessage.style.display = 'none';
                cartSummaryDiv.style.display = 'block';

                const fragment = document.createDocumentFragment();
                cart.forEach((item, index) => {
                    const card = cartItemTemplate.content.cloneNode(true).querySelector('.cart-item-card');
                    card.dataset.cartItemId = item.id;
                    
                    const imgElement = card.querySelector('.cart-item-image');
                    imgElement.dataset.src = item.menuImage; 

                    card.querySelector('.cart-item-name').textContent = item.menuName;
                    card.querySelector('.cart-item-store').textContent = `Dari: ${item.storeName}`;
                    card.querySelector('.cart-item-price').textContent = `Harga: ${formatPrice(item.basePrice)}`;
                    const extrasText = item.extras.length > 0 ? item.extras.map(e => `${e.name} (+${formatPrice(e.price)})`).join(', ') : 'Tidak ada';
                    card.querySelector('.cart-item-extras').textContent = `Extra: ${extrasText}`;
                    card.querySelector('.cart-item-notes').textContent = `Catatan: ${item.notes || '-'}`;
                    card.querySelector('.cart-item-qty').textContent = item.quantity;
                    const itemSubtotal = (item.basePrice + item.extras.reduce((sum, e) => sum + e.price, 0)) * item.quantity;
                    card.querySelector('.cart-item-subtotal').textContent = formatPrice(itemSubtotal);
                    card.querySelector('.cart-item-order-time').textContent = `Ditambahkan: ${new Date(item.orderTime).toLocaleString('id-ID')}`;
                    
                    card.querySelector('.remove-from-cart-btn').addEventListener('click', () => {
                        cart.splice(index, 1); saveCart(); renderCart();
                        showToast('Item dihapus dari keranjang.', 'info');
                    });
                    fragment.appendChild(card);
                });
                cartItemsContainer.appendChild(fragment);
                cartItemsContainer.querySelectorAll('.lazy-image[data-src]').forEach(img => observeImage(img));
                
                updateCartSummary(); updateCartBadge();
            }
            function calculateDeliveryFee(storeKm, destinationKm) {
                if (storeKm === null || destinationKm === null || isNaN(storeKm) || isNaN(destinationKm)) return 0;
                const distance = Math.abs(destinationKm - storeKm);
                if (distance < 2) return 5000;
                else return 5000 + (Math.max(0, Math.ceil(distance) - 1) * 1500); 
            }
            function updateCartSummary() {
                const subtotal = cart.reduce((sum, item) => sum + (item.basePrice + item.extras.reduce((acc, extra) => acc + extra.price, 0)) * item.quantity, 0);
                cartSubtotalSpan.textContent = formatPrice(subtotal);
                let deliveryFee = 0;
                const selectedLocationVal = deliveryLocationSelect.value;
                const locationDetailFilled = deliveryLocationDetailInput.value.trim() !== "";

                if (cart.length > 0 && selectedLocationVal !== "") {
                    const firstItemStoreId = cart[0].storeId;
                    const store = storesData.find(s => s.id === firstItemStoreId);
                    if (store && store.lokasitoko) {
                        const storeKm = getKmValueFromString(store.lokasitoko);
                        const destinationKm = parseInt(selectedLocationVal);
                        deliveryFee = calculateDeliveryFee(storeKm, destinationKm);
                    }
                }
                deliveryFeeSpan.textContent = formatPrice(deliveryFee);
                const totalPayment = subtotal + deliveryFee;
                cartTotalPaymentSpan.textContent = formatPrice(totalPayment);

                const canOrder = cart.length > 0;
                sendOrderBtn.disabled = !canOrder || selectedLocationVal === "" || !locationDetailFilled;
                deliveryLocationSelect.disabled = !canOrder;
                deliveryLocationDetailInput.disabled = !canOrder;
            }
            deliveryLocationSelect.addEventListener('change', updateCartSummary);
            deliveryLocationDetailInput.addEventListener('input', updateCartSummary);
            function updateCartBadge() {
                const count = cart.reduce((sum, item) => sum + item.quantity, 0); // Jumlah item unik, bukan total quantity
                // Jika ingin total quantity: cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCountBadge.style.display = cart.length > 0 ? 'inline-block' : 'none'; // Badge berdasarkan jumlah item unik
                cartCountBadge.textContent = cart.length; // Tampilkan jumlah item unik
            }

            // --- SEND ORDER & HISTORY ---
            sendOrderBtn.addEventListener('click', () => {
                if (cart.length === 0) { showToast('Keranjang Anda kosong.', 'error'); return; }
                const selectedLocationValue = deliveryLocationSelect.value;
                const selectedLocationText = deliveryLocationSelect.options[deliveryLocationSelect.selectedIndex].text;
                const deliveryDetail = deliveryLocationDetailInput.value.trim();

                if (selectedLocationValue === "") { showToast('Mohon pilih lokasi pengantaran.', 'error'); deliveryLocationSelect.focus(); return; }
                if (deliveryDetail === "") { showToast('Mohon isi detail lokasi pengantaran.', 'error'); deliveryLocationDetailInput.focus(); return; }

                const subtotal = cart.reduce((sum, item) => sum + (item.basePrice + item.extras.reduce((acc, e) => acc + e.price, 0)) * item.quantity, 0);
                const deliveryFee = parseInt(deliveryFeeSpan.textContent.replace(/[^0-9]/g, ''));
                const totalPayment = subtotal + deliveryFee;
                const now = new Date();
                const orderDateTime = now.toLocaleString('id-ID', { 
                    day: '2-digit', month: '2-digit', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit', hour12: false 
                }).replace(/\./g, ':'); // Ganti titik dengan : untuk format waktu yg umum

                let orderMessage = `Halo Admin, Tolong Proses Orderan saya:\n`;
                let storeOrders = {};
                cart.forEach(item => {
                    if (!storeOrders[item.storeName]) storeOrders[item.storeName] = [];
                    let itemText = `*${item.menuName}* - ${item.quantity}x (${formatPrice(item.basePrice)}/item)\n`;
                    if (item.extras.length > 0) itemText += `  Extra: ${item.extras.map(e => e.name + ' (' + formatPrice(e.price) + ')').join(', ')}\n`;
                    if (item.notes) itemText += `  Catatan: ${item.notes}\n`;
                    storeOrders[item.storeName].push(itemText);
                });
                for (const storeName in storeOrders) {
                    orderMessage += `\nDi: *${storeName.toUpperCase()}*\n`;
                    orderMessage += storeOrders[storeName].join(''); // Hapus newline tambahan antar item, karena itemText sudah punya \n
                }
                orderMessage += `\nSubtotal Pesanan: *${formatPrice(subtotal)}*\n`;
                orderMessage += `Ongkos Kirim: *${formatPrice(deliveryFee)}*\n`;
                orderMessage += `*TOTAL PEMBAYARAN: ${formatPrice(totalPayment)}*\n\n`;
                orderMessage += `Lokasi Pengantaran: ${selectedLocationText}\n`;
                orderMessage += `Detail Lokasi: ${deliveryDetail}\n`;
                orderMessage += `*Waktu Order: ${orderDateTime}*\n\n`; 
                orderMessage += `Terima kasih sudah Menggunakan aplikasi *Sipora Food*. mohon tunggu Konfirmasi Kami!`;

                const whatsappUrl = `https://wa.me/${WHATSAPP_ADMIN}?text=${encodeURIComponent(orderMessage)}`;

                const historyEntry = {
                    id: `hist-${Date.now()}`, items: JSON.parse(JSON.stringify(cart)), // Deep copy
                    totalAmount: totalPayment, deliveryFee: deliveryFee, subtotal: subtotal,
                    deliveryLocation: selectedLocationText,
                    deliveryLocationDetail: deliveryDetail,
                    orderTimestamp: new Date().toISOString()
                };

                // Pencegahan duplikasi riwayat yang sangat identik (opsional, tapi baik)
                const lastHistory = orderHistory.length > 0 ? orderHistory[orderHistory.length - 1] : null;
                let isDuplicateHistory = false;
                if (lastHistory) {
                    const normalizeItemsForCompare = (items) => JSON.stringify(items.map(i => ({sid:i.storeId, mid:i.menuId, q:i.quantity, e:i.extras.map(ex=>ex.name).sort(), n:i.notes})).sort((a,b)=>a.mid.localeCompare(b.mid)));
                    if(normalizeItemsForCompare(lastHistory.items) === normalizeItemsForCompare(historyEntry.items) &&
                       lastHistory.totalAmount === historyEntry.totalAmount &&
                       lastHistory.deliveryLocationDetail === historyEntry.deliveryLocationDetail) {
                        isDuplicateHistory = true; // Anggap duplikat jika item, total, dan detail lokasi sama
                    }
                }

                if (!isDuplicateHistory) {
                    orderHistory.push(historyEntry); 
                    saveHistory();
                }
                
                cart = []; saveCart();
                deliveryLocationSelect.value = ""; deliveryLocationDetailInput.value = "";
                renderCart(); 
                showToast('Pesanan dialihkan ke WhatsApp Admin...', 'success');
                window.open(whatsappUrl, '_blank'); 
                showPage('riwayat'); 
            });

            function renderHistory() {
                historyItemsContainer.innerHTML = '';
                if (orderHistory.length === 0) { if(emptyHistoryMessage) emptyHistoryMessage.style.display = 'block'; return; }
                if(emptyHistoryMessage) emptyHistoryMessage.style.display = 'none';
                [...orderHistory].reverse().forEach(histEntry => { 
                    const card = historyItemTemplate.content.cloneNode(true).querySelector('.history-item-card');
                    const storeNames = [...new Set(histEntry.items.map(item => item.storeName))].join(', ');
                    card.querySelector('.history-store-names').textContent = storeNames;
                    card.querySelector('.history-order-time').textContent = new Date(histEntry.orderTimestamp).toLocaleString('id-ID');
                    const historyBody = card.querySelector('.history-item-body');
                    histEntry.items.forEach(item => {
                        const itemDiv = document.createElement('div'); itemDiv.className = 'menu-item-entry';
                        let itemText = `${item.quantity}x ${item.menuName} (${formatPrice(item.basePrice)})`;
                        if (item.storeName !== storeNames && storeNames.includes(',')) itemText += ` (dari ${item.storeName})`; 
                        itemDiv.textContent = itemText;
                        if (item.extras.length > 0) {
                            const extrasDiv = document.createElement('div'); extrasDiv.className = 'extras';
                            extrasDiv.textContent = `Extra: ${item.extras.map(e => e.name).join(', ')}`;
                            itemDiv.appendChild(extrasDiv);
                        }
                        if (item.notes) {
                            const notesDiv = document.createElement('div'); notesDiv.className = 'extras'; 
                            notesDiv.textContent = `Catatan: ${item.notes}`;
                            itemDiv.appendChild(notesDiv);
                        }
                        historyBody.appendChild(itemDiv);
                    });
                    card.querySelector('.history-total-amount').textContent = formatPrice(histEntry.totalAmount);
                    card.querySelector('.history-delivery-fee').textContent = formatPrice(histEntry.deliveryFee);
                    card.querySelector('.history-delivery-location').textContent = histEntry.deliveryLocation || '-';
                    card.querySelector('.history-delivery-location-detail').textContent = histEntry.deliveryLocationDetail || '-';

                    card.querySelector('.reorder-btn').addEventListener('click', () => {
                        if (histEntry.items.length === 0) {
                             showToast('Tidak ada item untuk diorder ulang.', 'error'); return;
                        }
                        const targetStoreId = histEntry.items[0]?.storeId; // Semua item di history diasumsikan dari 1 toko
                        const targetStore = storesData.find(s => s.id === targetStoreId);
                        if (!targetStore || !isStoreOpen(targetStore.jamOperasional)) { 
                            showToast('Toko asal pesanan ini sedang tutup atau tidak tersedia lagi.', 'error'); 
                            return; 
                        }

                        if (cart.length > 0) {
                            if(cart[0].storeId !== targetStoreId) { 
                                if (!confirm('Keranjang berisi item dari toko lain. Kosongkan keranjang dan lanjutkan dengan pesanan ini?')) return;
                                cart = []; 
                            } else {
                                 if (!confirm('Ganti isi keranjang saat ini dengan item dari riwayat ini? Item yang sama (menu, extra, catatan) tidak akan ditambahkan lagi.')) { 
                                    return;
                                }
                                // Jika user OK, kita tidak kosongkan cart, tapi akan skip item duplikat.
                            }
                        } else {
                            cart = []; // Pastikan keranjang adalah array kosong jika sebelumnya tidak ada item
                        }


                        let itemsAddedCount = 0;
                        histEntry.items.forEach(histItem => {
                            const storeOfHistItem = storesData.find(s => s.id === histItem.storeId);
                            if (!storeOfHistItem || !isStoreOpen(storeOfHistItem.jamOperasional)) return; // Skip if store closed

                            const menuItem = storeOfHistItem.menu.find(m => m.id === histItem.menuId);
                            if (!menuItem || menuItem.status.toLowerCase() !== 'aktif') return; // Skip if menu inactive

                            // Cek duplikat dengan item yang sudah ada di keranjang
                            const sortedHistItemExtras = histItem.extras.sort((a,b) => a.name.localeCompare(b.name));
                            const existingCartItemIndex = cart.findIndex(cartItem =>
                                cartItem.menuId === histItem.menuId &&
                                cartItem.storeId === histItem.storeId &&
                                JSON.stringify(cartItem.extras.sort((a,b) => a.name.localeCompare(b.name))) === JSON.stringify(sortedHistItemExtras) &&
                                cartItem.notes === histItem.notes
                            );

                            if (existingCartItemIndex === -1) { // Hanya tambah jika belum ada di keranjang
                                cart.push({
                                    ...JSON.parse(JSON.stringify(histItem)), 
                                    id: `${histItem.storeId}-${histItem.menuId}-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`, 
                                    orderTime: new Date().toISOString() 
                                });
                                itemsAddedCount++;
                            }
                        });

                        if (itemsAddedCount > 0) {
                            saveCart();
                            showToast(`${itemsAddedCount} item berhasil dimuat ulang ke keranjang.`, 'success');
                        } else {
                            showToast('Tidak ada item baru yang ditambahkan (mungkin sudah ada di keranjang atau tidak tersedia).', 'info');
                        }
                        
                        // Set lokasi pengiriman dari riwayat
                        const historicLocationText = histEntry.deliveryLocation;
                        const optionInSelect = Array.from(deliveryLocationSelect.options).find(opt => opt.text === historicLocationText);
                        if (optionInSelect) deliveryLocationSelect.value = optionInSelect.value;
                        else deliveryLocationSelect.value = ""; 
                        deliveryLocationDetailInput.value = histEntry.deliveryLocationDetail || ""; 

                        showPage('keranjang'); 
                    });
                    historyItemsContainer.appendChild(card);
                });
            }

            // --- INITIALIZATION ---
            initializeImageObserver(); 
            renderStores(); 

            const validPages = ['home', 'keranjang', 'riwayat']; 
            const hashParts = window.location.hash.substring(1).split('/');
            let pageFromUrl = hashParts[0];
            let storeIdFromUrlIfModal = (hashParts.length > 2 && hashParts[1] === 'toko') ? hashParts[2] : null;
            
            let startPage = 'home';
            if (validPages.includes(pageFromUrl)) {
                startPage = pageFromUrl;
            }

            showPage(startPage); 
            
            // Handle initial state based on URL
            if (storeIdFromUrlIfModal) {
                const storeExists = storesData.find(s => s.id === storeIdFromUrlIfModal);
                if (storeExists) {
                    // Buka modal dan pastikan state history benar
                    // showPage sudah mengatur state page, kita replace untuk tambahkan info modal
                    history.replaceState({ 
                        page: startPage, 
                        modal: 'storeMenuOpen', 
                        storeId: storeIdFromUrlIfModal,
                        pageBeforeModal: startPage 
                    }, `Menu Toko`, `#${startPage}/toko/${storeIdFromUrlIfModal}`);
                    openMenuModal(storeIdFromUrlIfModal);
                } else {
                    // Jika storeId tidak valid, pastikan URL tidak ada info toko
                    history.replaceState({ page: startPage }, `Page ${startPage}`, `#${startPage}`);
                }
            } else if (history.state === null || history.state.page !== startPage ) {
                // Jika tidak ada modal di URL dan state belum benar
                 history.replaceState({ page: startPage }, `Page ${startPage}`, `#${startPage}`);
            }
            
            setTimeout(hideAppLoader, 350); 
        });
    </script>
</body>
</html>
